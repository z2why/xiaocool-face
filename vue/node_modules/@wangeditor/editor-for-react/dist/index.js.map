{"version":3,"file":"index.js","sources":["../src/components/Editor.tsx","../src/components/Toolbar.tsx"],"sourcesContent":["/**\n * @description editor react component\n * @author wangfupeng\n */\n\nimport React, { useRef, useEffect, useState } from 'react'\nimport {SlateDescendant, IEditorConfig, createEditor, IDomEditor, SlateEditor, SlateTransforms } from '@wangeditor/editor'\n\ninterface IProps {\n  defaultContent?: SlateDescendant[]\n  onCreated?: (editor: IDomEditor) => void\n  defaultHtml?: string\n  value?: string\n  onChange: (editor: IDomEditor) => void\n  defaultConfig: Partial<IEditorConfig>\n  mode?: string\n  style?: React.CSSProperties\n}\n\nfunction EditorComponent(props: Partial<IProps>) {\n  const { defaultContent = [], onCreated, defaultHtml = '', value = '', onChange, defaultConfig = {}, mode = 'default', style = {} } = props\n  const ref = useRef<HTMLDivElement>(null)\n  const [editor, setEditor] = useState<IDomEditor | null>(null)\n  const [curValue, setCurValue] = useState('')\n\n  const handleCreated = (editor: IDomEditor) => {\n    // 组件属性 onCreated\n    if (onCreated) onCreated(editor)\n\n    // 编辑器 配置 onCreated\n    const { onCreated: onCreatedFromConfig } = defaultConfig\n    if (onCreatedFromConfig) onCreatedFromConfig(editor)\n  }\n\n  const handleChanged = (editor: IDomEditor) => {\n    setCurValue(editor.getHtml()) // 记录当前 html 值\n\n    // 组件属性 onChange\n    if (onChange) onChange(editor)\n\n    // 编辑器 配置 onChange\n    const { onChange: onChangeFromConfig } = defaultConfig\n    if (onChangeFromConfig) onChangeFromConfig(editor)\n  }\n\n  const handleDestroyed = (editor: IDomEditor) => {\n    const { onDestroyed } = defaultConfig\n    setEditor(null)\n    if(onDestroyed) {\n      onDestroyed(editor)\n    }\n  }\n\n  // value 变化，重置 HTML\n  useEffect(() => {\n    if (editor == null) return\n\n    if (value === curValue) return // 如果和当前 html 值相等，则忽略\n\n    // ------ 重新设置 HTML ------\n    editor.setHtml(value)\n\n  }, [value])\n\n  useEffect(() => {\n    if (ref.current == null) return\n    if (editor != null) return\n    // 防止重复渲染 当编辑器已经创建就不在创建了\n    if (ref.current?.getAttribute('data-w-e-textarea')) return\n\n    const newEditor = createEditor({\n      selector: ref.current,\n      config: {\n        ...defaultConfig,\n        onCreated: handleCreated,\n        onChange: handleChanged,\n        onDestroyed: handleDestroyed,\n      },\n      content: defaultContent,\n      html: defaultHtml || value,\n      mode,\n    })\n    setEditor(newEditor)\n  }, [editor])\n\n  return <div style={style} ref={ref}></div>\n}\n\nexport default EditorComponent\n","/**\n * @description toolbar react component\n * @author wangfupeng\n */\n\nimport React, { useRef, useEffect } from 'react'\nimport * as wangEditor from '@wangeditor/editor'\n\ninterface IProps {\n  editor: wangEditor.IDomEditor | null\n  defaultConfig?: Partial<wangEditor.IToolbarConfig>\n  mode?: string\n  style?: object\n}\n\nfunction ToolbarComponent(props: IProps) {\n  const { editor, defaultConfig = {}, mode = 'default', style = {} } = props\n  const ref = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    if (ref.current == null) return\n    if (editor == null) return\n\n    wangEditor.createToolbar({\n      editor,\n      selector: ref.current,\n      config: defaultConfig,\n      mode,\n    })\n  }, [editor])\n\n  return <div style={style} ref={ref}></div>\n}\n\nexport default ToolbarComponent\n"],"names":["props","_a","defaultContent","onCreated","_b","defaultHtml","_c","value","onChange","_d","defaultConfig","_e","mode","_f","style","ref","useRef","_g","__read","useState","editor","setEditor","_h","curValue","setCurValue","handleCreated","onCreatedFromConfig","handleChanged","getHtml","onChangeFromConfig","handleDestroyed","onDestroyed","useEffect","setHtml","current","getAttribute","newEditor","createEditor","selector","config","__assign","content","html","React","createElement","wangEditor","createToolbar"],"mappings":"0sCAmBA,SAAyBA,GACf,IAAAC,EAA6HD,EAA1GE,eAAnBA,OAAc,IAAAD,EAAG,GAAEA,EAAEE,EAAwGH,EAA/FG,UAAEC,EAA6FJ,EAA7EK,YAAhBA,OAAW,IAAAD,EAAG,GAAEA,EAAEE,EAA2EN,EAAKO,MAAhFA,aAAQ,GAAED,EAAEE,EAA+DR,EAAvDQ,SAAEC,EAAqDT,EAAnCU,cAAlBA,OAAa,IAAAD,EAAG,GAAEA,EAAEE,EAAiCX,EAAjBY,KAAhBA,OAAI,IAAAD,EAAG,UAASA,EAAEE,EAAeb,EAAKc,MAApBA,OAAQ,IAAAD,EAAA,KACxHE,EAAMC,SAAuB,MAC7BC,EAAAC,EAAsBC,EAAQA,SAAoB,MAAK,GAAtDC,EAAMH,EAAA,GAAEI,OACTC,EAAAJ,EAA0BC,EAAQA,SAAC,IAAG,GAArCI,EAAQD,EAAA,GAAEE,OAEXC,EAAgB,SAACL,GAEjBjB,GAAWA,EAAUiB,GAGjB,IAAWM,EAAwBhB,EAAaP,UACpDuB,GAAqBA,EAAoBN,IAGzCO,EAAgB,SAACP,GACrBI,EAAYJ,EAAOQ,WAGfpB,GAAUA,EAASY,GAGf,IAAUS,EAAuBnB,EAAaF,SAClDqB,GAAoBA,EAAmBT,IAGvCU,EAAkB,SAACV,GACf,IAAAW,EAAgBrB,EAAaqB,YACrCV,EAAU,MACPU,GACDA,EAAYX,IAoChB,OA/BAY,EAAAA,WAAU,WACM,MAAVZ,GAEAb,IAAUgB,GAGdH,EAAOa,QAAQ1B,KAEd,CAACA,IAEJyB,EAAAA,WAAU,iBACR,GAAmB,MAAfjB,EAAImB,SACM,MAAVd,aAEAnB,EAAAc,EAAImB,8BAASC,aAAa,sBAA9B,CAEA,IAAMC,EAAYC,EAAAA,aAAa,CAC7BC,SAAUvB,EAAImB,QACdK,OACKC,EAAAA,EAAA,GAAA9B,GACH,CAAAP,UAAWsB,EACXjB,SAAUmB,EACVI,YAAaD,IAEfW,QAASvC,EACTwC,KAAMrC,GAAeE,EACrBK,KAAIA,IAENS,EAAUe,MACT,CAAChB,IAEGuB,EAAA,QAAAC,cAAA,MAAA,CAAK9B,MAAOA,EAAOC,IAAKA,eCtEjC,SAA0Bf,GAChB,IAAAoB,EAA6DpB,EAAKoB,OAA1DnB,EAAqDD,EAAKU,cAA1DA,OAAgB,IAAAT,EAAA,KAAIG,EAAiCJ,EAAKY,KAAtCA,OAAO,IAAAR,EAAA,YAAWE,EAAeN,EAAKc,MAApBA,OAAQ,IAAAR,EAAA,KACxDS,EAAMC,SAAuB,MAcnC,OAZAgB,EAAAA,WAAU,WACW,MAAfjB,EAAImB,SACM,MAAVd,GAEJyB,EAAWC,cAAc,CACvB1B,OAAMA,EACNkB,SAAUvB,EAAImB,QACdK,OAAQ7B,EACRE,KAAIA,MAEL,CAACQ,IAEGuB,EAAA,QAAAC,cAAA,MAAA,CAAK9B,MAAOA,EAAOC,IAAKA"}