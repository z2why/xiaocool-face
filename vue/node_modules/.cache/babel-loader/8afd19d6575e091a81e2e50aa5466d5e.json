{"ast":null,"code":"import \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport axios from 'axios';\nexport default {\n  name: 'join',\n  data: function data() {\n    return {};\n  },\n  methods: {\n    // 打开摄像头\n    openPhoto: function openPhoto() {\n      var _this2 = this;\n\n      // H5调用电脑摄像头API\n      //navigator.mediaDevices.getUserMedia 调用后 会提示用户给予使用媒体输入的许可.返回一个 Promise 对象，\n      //成功后会resolve回调一个 MediaStream 对象。\n      //在H5设备上面调用摄像头也可以通过此种方式，如下的例子表示优先使用前置摄像头\n      //{ audio: true, video: { facingMode: \"user\" } }前摄像头\n      //{ audio: true, video: { facingMode: { exact: \"environment\" } } }强制使用后置摄像头\n      //设置获取接近 1280x720 的相机分辨率\n      //{ audio: true, video: { width: 1280, height: 720 } };\n      navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: {\n          width: 1280,\n          height: 720\n        },\n        muted: {}\n      }).then(function (success) {\n        // 摄像头开启成功\n        _this2.$refs[\"video\"].srcObject = success; //srcObject 是实时流\n        // 实时拍照效果\n\n        _this2.$refs[\"video\"].play();\n      }).catch(function (error) {\n        //摄像头开启失败\n        console.error(\"摄像头开启失败\");\n      });\n\n      var _this = this;\n\n      setTimeout(function () {\n        _this.photograph();\n      }, 2000);\n    },\n    getDataUri: function getDataUri(url, callback) {\n      var _this3 = this;\n\n      var image = new Image();\n\n      image.onload = function () {\n        var canvas = document.createElement('canvas');\n        canvas.width = _this3.naturalWidth;\n        canvas.height = _this3.naturalHeight;\n        canvas.getContext('2d').drawImage(_this3, 0, 0);\n        callback(canvas.toDataUrl('image/png').replace(/^data:image\\/(png|jpg);base64,/, ''));\n        callback(canvas.toDataURL('image/png'));\n      };\n\n      image.src = url;\n    },\n    // 拍照\n    photograph: function photograph() {\n      var photoInfo = this.$refs[\"canvas\"].getContext(\"2d\"); // 把当前内容渲染到canvas上\n\n      photoInfo.drawImage(this.$refs[\"video\"], 0, 0, 640, 480); // //canvas图片 转base64格式、图片格式转换、图片质量压缩\n\n      var img = this.$refs[\"canvas\"].toDataURL(\"image/jpeg\");\n      var imgBase64 = this.$refs[\"canvas\"].toDataURL(\"image/jpeg\", 0.7);\n      var string = imgBase64.replace(\"data:image/jpeg;base64,\", \"\");\n      string = this.getDataUri(imgBase64, 'camera.jpg');\n      var url = 'https://xiaoku.store:5000/recognition';\n      var params = {\n        // title: '1213',\n        // desc: '321'\n        image: img\n      };\n      axios.post(url, params).then(function (res) {\n        console.log(res.data);\n      }).catch(function (err) {\n        alert(err);\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;AAmBA;AACA;EACAA,YADA;EAGAC,IAHA,kBAGA;IACA;EAGA,CAPA;EAUAC;IACA;IACAC,SAFA,uBAEA;MAAA;;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACAC,uBACAC,YADA,CACA;QACAC,WADA;QACAC;UAAAC;UAAAC;QAAA,CADA;QACAC;MADA,CADA,EAIAC,IAJA,CAIA;QACA;QACA,0CAFA,CAEA;QACA;;QACA;MACA,CATA,EAUAC,KAVA,CAUA;QACA;QACAC;MACA,CAbA;;MAcA;;MACAC;QACAC;MACA,CAFA,EAEA,IAFA;IAIA,CA9BA;IAiCAC,UAjCA,sBAiCAC,GAjCA,EAiCAC,QAjCA,EAiCA;MAAA;;MAEA;;MAEAC;QAEA;QAEAC;QAEAA;QAEAA;QAEAF;QAEAA;MAEA,CAdA;;MAgBAC;IAEA,CAvDA;IAwDA;IACAE,UAzDA,wBAyDA;MACA,sDADA,CAEA;;MACAC,yDAHA,CAKA;;MACA;MACA;MACA;MACAC;MAEA;MACA;QACA;QACA;QACAJ;MAHA;MAKAK,wBACAb,IADA,CACA;QACAE;MACA,CAHA,EAIAD,KAJA,CAIA;QACAa;MACA,CANA;IAOA;EAjFA;AAVA","names":["name","data","methods","openPhoto","navigator","getUserMedia","audio","video","width","height","muted","then","catch","console","setTimeout","_this","getDataUri","url","callback","image","canvas","photograph","photoInfo","string","axios","alert"],"sourceRoot":"src/views","sources":["join.vue"],"sourcesContent":["<template>\n\n\n<div>\n  <!--开启摄像头-->\n  <el-button size=\"mini\"   @click=\"openPhoto\" >摄像头</el-button>\n  <!--canvas截取流-->\n  <canvas ref=\"canvas\" width=\"500\" height=\"500\"></canvas>\n  <!--图片展示-->\n  <video ref=\"video\" width=\"500\" height=\"500\" autoplay></video>\n  <!--确认-->\n  <el-button size=\"mini\"  @click=\"photograph\">拍照</el-button>\n\n    </div>\n</template>\n<style scoped lang=\"less\">\n\n</style>\n<script>\nimport axios from 'axios'\nexport default {\n  name: 'join',\n\n  data() {\n    return {\n\n    };\n  },\n\n\n  methods: {\n    // 打开摄像头\n    openPhoto() {\n      // H5调用电脑摄像头API\n      //navigator.mediaDevices.getUserMedia 调用后 会提示用户给予使用媒体输入的许可.返回一个 Promise 对象，\n      //成功后会resolve回调一个 MediaStream 对象。\n      //在H5设备上面调用摄像头也可以通过此种方式，如下的例子表示优先使用前置摄像头\n      //{ audio: true, video: { facingMode: \"user\" } }前摄像头\n      //{ audio: true, video: { facingMode: { exact: \"environment\" } } }强制使用后置摄像头\n      //设置获取接近 1280x720 的相机分辨率\n      //{ audio: true, video: { width: 1280, height: 720 } };\n      navigator.mediaDevices\n          .getUserMedia({\n            audio: true, video: { width: 1280, height: 720 },muted:{}\n          })\n          .then((success) => {\n            // 摄像头开启成功\n            this.$refs[\"video\"].srcObject = success; //srcObject 是实时流\n            // 实时拍照效果\n            this.$refs[\"video\"].play();\n          })\n          .catch((error) => {\n            //摄像头开启失败\n            console.error(\"摄像头开启失败\");\n          });\n      let _this=this\n      setTimeout(function()  {\n        _this.photograph()\n      }, 2000);\n\n    },\n\n\n    getDataUri(url, callback){\n\n      let image = new Image()\n\n      image.onload = () => {\n\n        let canvas = document.createElement('canvas');\n\n        canvas.width = this.naturalWidth\n\n        canvas.height = this.naturalHeight\n\n        canvas.getContext('2d').drawImage(this, 0, 0)\n\n        callback(canvas.toDataUrl('image/png').replace(/^data:image\\/(png|jpg);base64,/, ''))\n\n        callback(canvas.toDataURL('image/png'))\n\n      }\n\n      image.src = url\n\n    },\n    // 拍照\n    photograph() {\n      let photoInfo= this.$refs[\"canvas\"].getContext(\"2d\");\n      // 把当前内容渲染到canvas上\n      photoInfo.drawImage(this.$refs[\"video\"], 0, 0, 640, 480);\n\n      // //canvas图片 转base64格式、图片格式转换、图片质量压缩\n      let img = this.$refs[\"canvas\"].toDataURL(\"image/jpeg\");\n      let imgBase64 = this.$refs[\"canvas\"].toDataURL(\"image/jpeg\", 0.7);\n      let string = imgBase64.replace(\"data:image/jpeg;base64,\", \"\");\n      string=this.getDataUri(imgBase64, 'camera.jpg');\n\n        var url = 'https://xiaoku.store:5000/recognition'\n        var params = {\n          // title: '1213',\n          // desc: '321'\n          image:img\n        }\n         axios.post(url, params)\n            .then(res => {\n              console.log(res.data)\n            })\n            .catch(err => {\n              alert(err)\n            })\n      }\n    }\n\n};\n</script>\n\n"]},"metadata":{},"sourceType":"module"}