{"ast":null,"code":"import _defineProperty from \"C:/Users/86134/Desktop/\\u7231\\u8BFB\\u4E66/springboot-vue/vue/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport \"core-js/modules/es.error.cause.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  props: {\n    tackPhoto: {\n      //父组件传过来的状态\n      type: Boolean,\n      default: false\n    }\n  },\n  data: function data() {\n    return {\n      loadingbut: false,\n      preViewVisible: false,\n      blobFile: null,\n      canvas: null,\n      video: null,\n      mediaStreamTrack: ''\n    };\n  },\n  watch: {\n    tackPhoto: {\n      immediate: true,\n      handler: function handler(newVal) {\n        //监听接收到拍摄状态后，开始调取摄像头权限。如果功能是在一个组件里面，下面步骤可以直接写在自己的触发方法里面\n        if (newVal) {\n          var video = document.querySelector('video');\n          var text = document.getElementById('text'); // var mediaStreamTrack;\n          // 兼容代码\n\n          window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n          if (navigator.mediaDevices === undefined) {\n            navigator.mediaDevices = {};\n          }\n\n          if (navigator.mediaDevices.getUserMedia === undefined) {\n            navigator.mediaDevices.getUserMedia = function (constraints) {\n              var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n\n              if (!getUserMedia) {\n                return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\n              }\n\n              return new Promise(function (resolve, reject) {\n                getUserMedia.call(navigator, constraints, resolve, reject);\n              });\n            };\n          } //摄像头调用配置\n\n\n          var mediaOpts = _defineProperty({\n            audio: false,\n            video: true\n          }, \"video\", {\n            facingMode: \"environment\"\n          });\n\n          var that = this;\n          navigator.mediaDevices.getUserMedia(mediaOpts).then(function (stream) {\n            that.mediaStreamTrack = stream;\n            video = document.querySelector('video');\n\n            if (\"srcObject\" in video) {\n              video.srcObject = stream;\n            } else {\n              video.src = window.URL && window.URL.createObjectURL(stream) || stream;\n            }\n\n            video.play();\n          }).catch(function (err) {\n            console.log(err);\n          });\n        }\n      },\n      deep: true\n    }\n  },\n  mounted: function mounted() {\n    // 摄像头\n    this.video = document.getElementById('video'); //画布\n\n    this.canvas = document.getElementById('canvas');\n  },\n  methods: {\n    takePhone: function takePhone() {\n      //点击拍照截图画面\n      var that = this;\n      that.canvas.getContext('2d').drawImage(this.video, 0, 0, 400, 300);\n      var dataurl = that.canvas.toDataURL('image/jpeg');\n      that.blobFile = that.dataURLtoFile(dataurl, 'camera.jpg');\n      that.preViewVisible = true;\n    },\n    takePhoneUpfile: function takePhoneUpfile() {\n      //保存图片\n      this.loadingbut = true;\n      var formData = new FormData();\n      formData.append('file', this.blobFile); //图片内容\n      // // 上传图片\n      // putFileAttach(formData).then(res=>{//后台接口\n      //   this.loadingbut=false;\n      //   this.$emit('picture',res.data.data);\n      //   this.tackPhoto=false;\n      //   this.canvas.getContext('2d').clearRect(0, 0, 400, 300);//清除画布\n      //   // 关闭摄像头\n      //   this.mediaStreamTrack.getVideoTracks().forEach(function (track) {\n      //     track.stop();\n      //   });\n      // },error=>{\n      //   this.loadingbut=false;\n      //   window.console.log(error);\n      // });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwBA;EACAA;IACAC;MAAA;MACAC,aADA;MAEAC;IAFA;EADA,CADA;EAOAC,IAPA,kBAOA;IACA;MACAC,iBADA;MAEAC,qBAFA;MAGAC,cAHA;MAIAC,YAJA;MAKAC,WALA;MAMAC;IANA;EAQA,CAhBA;EAiBAC;IACAV;MACAW,eADA;MAEAC,OAFA,mBAEAC,MAFA,EAEA;QAAA;QACA;UACA;UACA,2CAFA,CAGA;UAEA;;UACAC;;UAEA;YACAC;UACA;;UACA;YACAA;cACA;;cACA;gBACA;cACA;;cACA;gBACAC;cACA,CAFA;YAGA,CARA;UASA,CArBA,CAuBA;;;UACA;YACAC,YADA;YAEAT;UAFA,YAGA;YAAAU;UAAA,CAHA;;UAQA;UACAH;YACAI;YACAX;;YACA;cACAA;YACA,CAFA,MAEA;cACAA;YACA;;YACAA;UACA,CATA,EASAY,KATA,CASA;YACAC;UACA,CAXA;QAaA;MACA,CAlDA;MAmDAC;IAnDA;EADA,CAjBA;EAwEAC,OAxEA,qBAwEA;IACA;IACA,8CAFA,CAGA;;IACA;EAEA,CA9EA;EA+EAC;IACAC,SADA,uBACA;MAAA;MACA;MACAN;MACA;MACAA;MACAA;IACA,CAPA;IAQAO,eARA,6BAQA;MAAA;MACA;MACA;MACAC,uCAHA,CAGA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;EA1BA;AA/EA","names":["props","tackPhoto","type","default","data","loadingbut","preViewVisible","blobFile","canvas","video","mediaStreamTrack","watch","immediate","handler","newVal","window","navigator","getUserMedia","audio","facingMode","that","catch","console","deep","mounted","methods","takePhone","takePhoneUpfile","formData"],"sourceRoot":"src/views","sources":["join.vue"],"sourcesContent":["<template>\n  <div class=\"camera-box\" style=\"width: 900px;\">\n    <el-button type='primary' size='small' icon=\"el-icon-camera\" @click=\"this.tackPhoto=\" style=\"margin-top: 10px;\">拍照</el-button>\n\n    <el-row :gutter=\"20\">\n      <el-col :span=\"12\">\n        <div style=\"text-align: center;font-size: 14px;font-weight: bold;margin-bottom: 10px;\">摄像头</div>\n        <!-- 这里就是摄像头显示的画面 -->\n        <video id=\"video\" width=\"400\" height=\"300\"></video>\n        <div class=\"iCenter\" >\n          <el-button type='primary' size='small' icon=\"el-icon-camera\" @click=\"takePhone\" style=\"margin-top: 10px;\">拍照</el-button>\n        </div>\n      </el-col>\n      <el-col :span=\"12\">\n        <div style=\"text-align: center;font-size: 14px;font-weight: bold;margin-bottom: 10px;\">拍摄效果</div>\n        <!-- 这里是点击拍照显示的图片画面 -->\n        <canvas id='canvas' width='400' height='300' style=\"display: block;\"></canvas>\n        <el-button :loading=\"loadingbut\" icon=\"el-icon-check\" type='primary' size='small' @click=\"takePhoneUpfile\" style=\"margin-top: 10px;\">保存</el-button>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n<script>\n\nexport default {\n  props:{\n    tackPhoto:{//父组件传过来的状态\n      type:Boolean,\n      default:false\n    }\n  },\n  data() {\n    return {\n      loadingbut:false,\n      preViewVisible: false,\n      blobFile: null,\n      canvas: null,\n      video: null,\n      mediaStreamTrack: '',\n    }\n  },\n  watch:{\n    tackPhoto:{\n      immediate: true,\n      handler (newVal) {//监听接收到拍摄状态后，开始调取摄像头权限。如果功能是在一个组件里面，下面步骤可以直接写在自己的触发方法里面\n        if (newVal) {\n          var video = document.querySelector('video');\n          var text = document.getElementById('text');\n          // var mediaStreamTrack;\n\n          // 兼容代码\n          window.URL = (window.URL || window.webkitURL || window.mozURL || window.msURL);\n\n          if (navigator.mediaDevices === undefined) {\n            navigator.mediaDevices = {};\n          }\n          if (navigator.mediaDevices.getUserMedia === undefined) {\n            navigator.mediaDevices.getUserMedia = function(constraints) {\n              var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n              if (!getUserMedia) {\n                return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\n              }\n              return new Promise(function(resolve, reject) {\n                getUserMedia.call(navigator, constraints, resolve, reject);\n              });\n            }\n          }\n\n          //摄像头调用配置\n          var mediaOpts = {\n            audio: false,\n            video: true,\n            video: { facingMode: \"environment\"} // 或者 \"user\"\n            // video: { width: 1280, height: 720 }\n            // video: { facingMode: { exact: \"environment\" } }// 或者 \"user\"\n          }\n\n          let that=this;\n          navigator.mediaDevices.getUserMedia(mediaOpts).then(function(stream) {\n            that.mediaStreamTrack = stream;\n            video = document.querySelector('video');\n            if (\"srcObject\" in video) {\n              video.srcObject = stream\n            } else {\n              video.src = window.URL && window.URL.createObjectURL(stream) || stream\n            }\n            video.play();\n          }).catch(function (err) {\n            console.log(err)\n          });\n\n        }\n      },\n      deep:true\n    },\n  },\n  mounted() {\n    // 摄像头\n    this.video = document.getElementById('video');\n    //画布\n    this.canvas = document.getElementById('canvas')\n\n  },\n  methods: {\n    takePhone() {//点击拍照截图画面\n      let that = this;\n      that.canvas.getContext('2d').drawImage(this.video, 0, 0, 400, 300) ;\n      let dataurl = that.canvas.toDataURL('image/jpeg')\n      that.blobFile = that.dataURLtoFile(dataurl, 'camera.jpg');\n      that.preViewVisible = true\n    },\n    takePhoneUpfile() {//保存图片\n      this.loadingbut=true;\n      let formData = new FormData()\n      formData.append('file', this.blobFile);//图片内容\n      // // 上传图片\n      // putFileAttach(formData).then(res=>{//后台接口\n      //   this.loadingbut=false;\n      //   this.$emit('picture',res.data.data);\n      //   this.tackPhoto=false;\n      //   this.canvas.getContext('2d').clearRect(0, 0, 400, 300);//清除画布\n      //   // 关闭摄像头\n      //   this.mediaStreamTrack.getVideoTracks().forEach(function (track) {\n      //     track.stop();\n      //   });\n      // },error=>{\n      //   this.loadingbut=false;\n      //   window.console.log(error);\n      // });\n    },\n  }\n}\n</script>\n<style>\n.camera-box #canvas{\n  border: 1px solid #DCDFE6;\n}\n</style>"]},"metadata":{},"sourceType":"module"}