{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as faceapi from 'face-api.js';\nexport default {\n  mounted() {\n    this.loadModels();\n  },\n\n  methods: {\n    async loadModels() {\n      // 加载模型\n      const MODEL_URL = '/models';\n      await faceapi.loadModels(MODEL_URL);\n      this.enableCamera();\n    },\n\n    async enableCamera() {\n      const video = document.getElementById('videoElement');\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {}\n      });\n      video.srcObject = stream;\n      await faceapi.warmupModels(video);\n    },\n\n    async startLivenessDetection() {\n      const video = document.getElementById('videoElement');\n      const displaySize = {\n        width: video.offsetWidth,\n        height: video.offsetHeight\n      };\n      faceapi.matchDimensions(video, displaySize);\n      setInterval(async () => {\n        const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions();\n        const resizedDetections = detections.map(d => d.forSize(displaySize));\n        const livenessDetected = resizedDetections.every(d => d.expressions[0].probability > 0.5);\n\n        if (livenessDetected) {\n          // 活体检测通过\n          console.log('Liveness detected');\n        } else {\n          // 活体检测失败\n          console.log('Liveness not detected');\n        }\n      }, 100);\n    }\n\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyCA;AAEA;EACAA;IACA;EACA,CAHA;;EAIAC;IACA;MACA;MACA;MACA;MACA;IACA,CANA;;IAOA;MACA;MACA;QAAAC;MAAA;MACAA;MACA;IACA,CAZA;;IAaA;MACA;MACA;QAAAC;QAAAC;MAAA;MACAC;MAEAC;QACA;QACA;QACA;;QAEA;UACA;UACAC;QACA,CAHA,MAGA;UACA;UACAA;QACA;MACA,CAZA,EAYA,GAZA;IAaA;;EA/BA;AAJA","names":["mounted","methods","video","width","height","faceapi","setInterval","console"],"sourceRoot":"src/views","sources":["Home.vue"],"sourcesContent":["<template>\r\n  <div>\r\n\r\n      <el-card style=\"width: 1257px;\r\n        height: 793px\" v-if=\"this.ux===2\">\r\n        <svg t=\"1659631982744\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"7781\" width=\"25\" height=\"25\"><path d=\"M370.323 184l-34.607 132.29L127 344.086V841h773V344.055l-210.831-28.207L654.677 184H370.323z m-82.459 78.132l24.412-93.317c6.907-26.4 30.758-44.815 58.047-44.815h284.354c27.289 0 51.14 18.415 58.047 44.815l24.303 92.901 170.93 22.87c29.796 3.986 52.043 29.407 52.043 59.47V841c0 33.137-26.863 60-60 60H127c-33.137 0-60-26.863-60-60V344.087c0-30.076 22.267-55.504 52.079-59.475l168.785-22.48z\" fill=\"#239fe0\" p-id=\"7782\"></path><path d=\"M512.5 781C387.96 781 287 680.04 287 555.5S387.96 330 512.5 330 738 430.96 738 555.5 637.04 781 512.5 781z m0-60c91.403 0 165.5-74.097 165.5-165.5S603.903 390 512.5 390 347 464.097 347 555.5 421.097 721 512.5 721z\" fill=\"#239fe0\" p-id=\"7783\"></path></svg>\r\n        <span style=\"       padding-left: 14px; position: relative; top: -5px; font-size: 18px;\">拍取人脸识别照片</span>\r\n        <el-divider></el-divider>\r\n\r\n        <div>\r\n<!--          开启摄像头-->\r\n          <el-button size=\"mini\" @click=\"openPhoto\">摄像头</el-button>\r\n<!--          canvas截取流  图片展示-->\r\n          <div class=\"rain\">\r\n\r\n            <div class=\"rainbow\" style=\"  padding: 5px 5px 5px 5px;  left: auto;width: 500px; height: 500px;\">\r\n              <video  ref=\"video\" style=\" height: 100%;width:100%\" muted autoplay playsinline></video>\r\n            </div>\r\n            <svg  @click=\"photograph\" style=\"position: relative; left: 217px; top: 70px;}\" t=\"1659901146637\" class=\"icon\" viewBox=\"0 0 1032 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"1641\" width=\"64\" height=\"64\"><path d=\"M512 1024C229.236953 1024 0 794.784665 0 512 0 229.236953 229.236953 0 512 0c282.763047 0 512 229.236953 512 512 0 282.763047-229.215335 512-512 512z m0-68.247931c245.082925 0 443.752069-198.669144 443.752069-443.752069 0-245.061307-198.669144-443.730451-443.752069-443.730451-245.061307 0-443.730451 198.669144-443.730451 443.730451 0 245.082925 198.669144 443.752069 443.730451 443.752069z m0-47.797332C293.355852 907.954737 116.045263 730.687384 116.045263 512c0-218.665766 177.267353-395.954737 395.954737-395.954737S907.954737 293.312616 907.954737 512 730.687384 907.954737 512 907.954737z\" p-id=\"1642\" fill=\"#ffffff\"></path></svg>\r\n          </div>\r\n          <el-button @click=\"ux=1\">已有照片,进行上传</el-button>\r\n          <!--      视频流-->\r\n          <div class=\"renlian1\"  style=\"position:relative;border:5px solid #909399;left: 633px; top: -511px; height: 500px; width: 500px;\">\r\n            <canvas ref=\"canvas\" height=\"500\" width=\"500\"\r\n                    style=\"position: absolute;left: -21px; transform: rotateY(180deg); PADDING: 0px 0px 0px 12px; width: 511px;height: 511px;\"></canvas>\r\n\r\n            <!--      确认-->\r\n    <!--        <el-button size=\"mini\" style=\"position: relative;top: 1px\" @click=\"photograph\">拍照</el-button>-->\r\n          </div>\r\n\r\n\r\n        </div>\r\n\r\n      </el-card>\r\n\r\n    <video id=\"videoElement\" width=\"720\" height=\"560\" autoplay muted></video>\r\n    <button @click=\"startLivenessDetection\">开始活体检测</button>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as faceapi from 'face-api.js';\r\n\r\nexport default {\r\n  mounted() {\r\n    this.loadModels();\r\n  },\r\n  methods: {\r\n    async loadModels() {\r\n      // 加载模型\r\n      const MODEL_URL = '/models';\r\n      await faceapi.loadModels(MODEL_URL);\r\n      this.enableCamera();\r\n    },\r\n    async enableCamera() {\r\n      const video = document.getElementById('videoElement');\r\n      const stream = await navigator.mediaDevices.getUserMedia({ video: {} });\r\n      video.srcObject = stream;\r\n      await faceapi.warmupModels(video);\r\n    },\r\n    async startLivenessDetection() {\r\n      const video = document.getElementById('videoElement');\r\n      const displaySize = { width: video.offsetWidth, height: video.offsetHeight };\r\n      faceapi.matchDimensions(video, displaySize);\r\n\r\n      setInterval(async () => {\r\n        const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions();\r\n        const resizedDetections = detections.map(d => d.forSize(displaySize));\r\n        const livenessDetected = resizedDetections.every(d => d.expressions[0].probability > 0.5);\r\n\r\n        if (livenessDetected) {\r\n          // 活体检测通过\r\n          console.log('Liveness detected');\r\n        } else {\r\n          // 活体检测失败\r\n          console.log('Liveness not detected');\r\n        }\r\n      }, 100);\r\n    }\r\n  }\r\n};\r\n</script>"]},"metadata":{},"sourceType":"module"}