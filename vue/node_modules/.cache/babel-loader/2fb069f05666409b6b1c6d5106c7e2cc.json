{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as echarts from 'echarts';\nimport { Editor, Toolbar } from \"@wangeditor/editor-for-vue\";\nimport Map from \"@/views/Map\";\nimport moment from \"moment\";\nimport axios from 'axios';\nexport default {\n  name: \"tabMyMeeting\",\n  components: {\n    Editor,\n    Toolbar,\n    Map\n  },\n  children: [{\n    name: 'Map',\n    path: 'Map',\n    components: Map\n  }],\n\n  data() {\n    return {\n      user: {},\n      mid: '',\n      theface: false,\n      activeName: \"first\",\n      tableData: [],\n      pageNum: 1,\n      pageSize: 8,\n      dialogTables: false,\n      dialogTableVisible: false,\n      dialogTable: false,\n      form: {},\n      getData: [],\n      information: {},\n      Allnum: '',\n      Earlynum: '',\n      LATERnum: '',\n      Alrnum: '',\n      mename: '',\n      allmeeting: '',\n      rate: '',\n      faceIn: 1,\n      meeting: [],\n      downloadLoading: false,\n      Nums: ''\n    };\n  },\n\n  created() {\n    //请求分页查询数据\n    this.user = JSON.parse(localStorage.getItem(\"user\"));\n    this.load();\n  },\n\n  methods: {\n    drawLine() {\n      let chartDom = document.getElementById('main');\n      let myChart = echarts.init(chartDom);\n      var option = {\n        title: {\n          text: '各季度会议展开情况',\n          size: 'large',\n          left: 'center'\n        },\n        tooltip: {\n          trigger: 'item'\n        },\n        xAxis: {\n          type: 'category',\n          data: [\"第一季度\", \"第二季度\", \"第三季度\", \"第四季度\"]\n        },\n        yAxis: {\n          type: 'value'\n        },\n        series: [{\n          data: [],\n          type: 'line'\n        }, {\n          data: [],\n          type: 'bar'\n        }]\n      };\n      this.request.get(\"/echarts/members\").then(res => {\n        this.allmeeting = res.data[0] + res.data[1] + res.data[2] + res.data[3];\n        option.series[0].data = res.data;\n        option.series[1].data = res.data;\n        myChart.setOption(option);\n      });\n    },\n\n    drawBar() {\n      echarts.init(document.getElementById('pie'));\n      let myChart = echarts.init(document.getElementById('pie'));\n      const option = {\n        title: {\n          text: '该会议人员参会情况',\n          size: 'large',\n          left: 'center'\n        },\n        tooltip: {\n          trigger: 'item'\n        },\n        legend: {\n          top: '5%',\n          left: 'center'\n        },\n        series: [{\n          name: '该会议人员参会情况',\n          type: 'pie',\n          radius: ['40%', '70%'],\n          avoidLabelOverlap: false,\n          itemStyle: {\n            borderRadius: 10,\n            borderColor: '#fff',\n            borderWidth: 2\n          },\n          label: {\n            show: false,\n            position: 'center'\n          },\n          emphasis: {\n            label: {\n              show: true,\n              fontSize: '40',\n              fontWeight: 'bold'\n            }\n          },\n          labelLine: {\n            show: false\n          },\n          data: []\n        }]\n      };\n      this.request.get(\"/echarts/hello\", {\n        params: {\n          meetingId: this.mid\n        }\n      }).then(res => {\n        this.rate = (res.data[0].value / this.Nums).toFixed(2) * 100;\n        option.series[0].data = res.data;\n        option.series[0].data.push({\n          name: '未签到',\n          value: this.Nums - res.data[0].value - res.data[1].value - res.data[2].value\n        });\n        myChart.setOption(option);\n      });\n    },\n\n    open() {\n      const t = this;\n      setTimeout(() => {\n        //  执行echarts画图方法\n        t.drawBar();\n        t.drawLine();\n      }, 0);\n    },\n\n    load() {\n      this.request.get(\"/AboutMeeting/findMeeting\", {\n        params: {\n          pageNum: this.pageNum,\n          pageSize: this.pageSize,\n          code: this.code,\n          userId: this.user.id,\n          myMeeting: 1\n        }\n      }).then(res => {\n        this.tableData = res;\n      });\n    },\n\n    MeetingInformation(row) {\n      this.mid = row.meetingId;\n      this.mename = row.name;\n      this.request.get(\"/AboutMeeting/findMember\", {\n        params: {\n          pageNum: 1,\n          pageSize: 100,\n          code: row.code\n        }\n      }).then(res => {\n        this.Nums = res.data.total;\n      });\n      this.dialogTables = true;\n      this.request.get(\"/echarts\", {\n        params: {\n          meetingId: row.meetingId\n        }\n      }).then(res => {\n        this.information = res.data;\n        this.meeting.meetingId = row.meetingId;\n      });\n    },\n\n    MeetingDetail(row) {\n      this.form = row;\n      this.dialogTableVisible = true;\n    },\n\n    exp() {\n      this.downloadLoading = true;\n      import('@/utils/Export2Excel.js').then(excel => {\n        const tHeader = ['会议号', '用户编号', '用户姓名', '签到情况', '签到时间', '签退时间'];\n        const filterVal = ['code', 'userId', 'uname', 'participateStatus', 'signInDate', 'signOutDate'];\n        excel.export_json_to_excel2(tHeader, this.getData, filterVal, this.mename + '参会人员信息');\n        this.downloadLoading = false;\n      });\n    },\n\n    handleSizeChange(pageSize) {\n      this.pageSize = pageSize;\n      this.load();\n    },\n\n    handleCurrentChange(pageNum) {\n      this.pageNum = pageNum;\n      this.load();\n    },\n\n    meetingHandle(row) {\n      if (row.stage === 1 && row.show === 1) {\n        this.$confirm('将于现在进入【' + row.name + '】会议, 是否确带继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          this.request.get(\"/AboutMeeting/join\", {\n            params: {\n              code: row.code,\n              userId: this.user.id\n            }\n          }).then(res => {\n            if (res.code === '200') {\n              this.form = res.data;\n            } else {\n              this.$message({\n                type: 'error',\n                showClose: true,\n                message: '有误！'\n              });\n            }\n          });\n          this.joinMeeting(row);\n        });\n      } else if (row.stage === 2) {\n        this.$message({\n          type: 'error',\n          showClose: true,\n          message: '会议已结束！'\n        });\n      } else if (row.stage === 0) {\n        this.$message({\n          type: 'warning',\n          showClose: true,\n          message: '会议还未开始！'\n        });\n      } else {\n        this.$message({\n          type: 'error',\n          showClose: true,\n          message: '还未通过审核！'\n        });\n      }\n    },\n\n    // ----------------------------------人脸识别模块-----------------------------------------\n    // 开始会议\n    joinMeeting(row) {\n      if (row.status === 0) {\n        if (row.createUser === this.user.id) {\n          localStorage.setItem(\"meeting\", JSON.stringify(row)); // 存储用户信息到浏览器\n\n          this.$router.push(\"/AllSign\");\n        } else {\n          this.$message.error(\"您无权操作！\");\n        }\n      } else {\n        if (this.faceIn === 1) {\n          this.theface = true;\n          this.openPhoto();\n        }\n\n        if (this.faceIn === 0) {\n          this.dialogTable = true;\n          this.faceIn = 1;\n        }\n      }\n    },\n\n    //人脸识别\n    openPhoto() {\n      navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: {\n          width: 720,\n          height: 720\n        }\n      }).then(success => {\n        // 摄像头开启成功\n        this.$refs[\"video\"].srcObject = success; //srcObject 是实时流\n        // 实时拍照效果\n\n        this.$refs[\"video\"].play();\n\n        let _this = this;\n\n        setTimeout(function () {\n          _this.photograph();\n        }, 1140);\n      }).catch(() => {\n        this.theface = false; //摄像头开启失败\n\n        this.$message.error(\"识别失败！即将进行手动签到\");\n        this.dialogTable = true;\n        this.faceIn = 1;\n      });\n    },\n\n    base64toFile(dataBase64, filename = 'file') {\n      let arr = dataBase64.split(',');\n      let mime = arr[0].match(/:(.*?);/)[1]; //设置file⽂件流的type名称\n\n      let suffix = mime.split('/')[1]; //设置file⽂件流的name名称\n\n      const bstr = window.atob(arr[1]);\n      let n = bstr.length;\n      const u8arr = new Uint8Array(n);\n\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n\n      return new File([u8arr], `${filename}.${suffix}`, {\n        type: mime\n      });\n    },\n\n    // 拍照\n    photograph() {\n      let photoInfo = this.$refs[\"canvas\"].getContext(\"2d\"); // 把当前内容渲染到canvas上\n\n      photoInfo.drawImage(this.$refs[\"video\"], 0, 0, 480, 480); // //canvas图片 转base64格式、图片格式转换、图片质量压缩\n\n      let img = this.$refs[\"canvas\"].toDataURL(\"image/jpg\");\n      let imgBase64 = this.$refs[\"canvas\"].toDataURL(\"image/jpg\", 0.7);\n      let string = imgBase64.replace(\"data:image/jpg;base64,\", \"\");\n      string = this.base64toFile(imgBase64, 'camera');\n      let formData = new FormData();\n      formData.append('image', string);\n      var url = 'https://xiaoku.store:5000/recognition';\n      axios.post(url, formData).then(res => {\n        //人脸识别成功\n        let that = this;\n\n        if (res.data.results[0].username === this.user.name) {\n          //签到信息\n          let t1 = moment().startOf('millisecond').format(\"YYYY-MM-DD HH:mm:ss\");\n          const form3 = {\n            id: that.form.udid,\n            meetingId: that.form.meetingId,\n            userId: that.user.id\n          };\n          form3.signInDate = JSON.parse(JSON.stringify(t1)); // this.form.udid=form3.id\n\n          let t2 = moment(that.form.startDate).format(\"YYYY-MM-DD HH:mm:ss\");\n\n          if (t2 >= t1) {\n            form3.participateStatus = 1;\n          }\n\n          if (t2 < t1) {\n            form3.participateStatus = 2;\n          }\n\n          if (that.form.participateStatus === 0) {\n            that.request.post(\"/AboutMeeting/manualSign\", form3).then(res => {\n              if (res.code === '200') {\n                that.$message.success(\"签到成功\");\n\n                if (that.form.createUser === that.user.id) {\n                  that.$message.success(\"创建成功\");\n                  that.$router.push({\n                    name: \"theMeeting\",\n                    params: {\n                      meetingName: that.form.mname,\n                      meetingId: that.form.meetingId,\n                      roomId: that.form.code,\n                      udid: that.form.udid,\n                      qwq: 1\n                    }\n                  });\n                } else {\n                  that.$message.success(\"加入成功\");\n                  that.$router.push({\n                    name: \"theMeeting\",\n                    params: {\n                      meetingName: that.form.mname,\n                      meetingId: that.form.meetingId,\n                      udid: that.form.udid,\n                      roomId: that.form.code\n                    }\n                  });\n                }\n              }\n            });\n          } else {\n            that.$message.error(\"您已签到,请勿重复签到！\");\n\n            if (that.form.createUser === that.user.id) {\n              that.$message.success(\"创建成功\");\n              that.$router.push({\n                name: \"theMeeting\",\n                params: {\n                  meetingName: that.form.mname,\n                  meetingId: that.form.meetingId,\n                  roomId: that.form.code,\n                  udid: that.form.udid,\n                  qwq: 1\n                }\n              });\n            } else {\n              that.$message.success(\"加入成功!\");\n              that.$router.push({\n                name: \"theMeeting\",\n                params: {\n                  meetingName: that.form.mname,\n                  meetingId: that.form.meetingId,\n                  roomId: that.form.code,\n                  udid: that.form.udid\n                }\n              });\n            }\n          }\n        } else {\n          this.theface = false;\n          that.$message.error(\"识别失败！即将进行手动签到\");\n          that.faceIn = 0;\n\n          if (that.faceIn === 0) {\n            that.dialogTable = true;\n            that.faceIn = 1;\n          }\n        }\n      }).catch(err => {\n        this.theface = false;\n        this.$message.error(\"识别失败！即将进行手动签到\");\n        this.faceIn = 0;\n\n        if (this.faceIn === 0) {\n          this.dialogTable = true;\n          this.faceIn = 1;\n        }\n      });\n    },\n\n    cback() {\n      this.dialogTable = false;\n    },\n\n    sign() {\n      this.request.get(\"/AboutMeeting/findMeeting\", {\n        params: {\n          pageSize: 1,\n          pageNum: 1,\n          userId: this.user.id,\n          code: this.form.code\n        }\n      }).then(res => {\n        const form3 = {\n          id: res[0].uid,\n          udid: res[0].uid,\n          meetingId: res[0].meetingId,\n          userId: this.user.id,\n          code: res[0].code,\n          meetingName: res[0].name\n        };\n        let t1 = moment().startOf('millisecond').format(\"YYYY-MM-DD HH:mm:ss\");\n        form3.signInDate = JSON.parse(JSON.stringify(t1));\n        let t2 = moment(this.form.startDate).format(\"YYYY-MM-DD HH:mm:ss\");\n\n        if (t2 >= t1) {\n          form3.participateStatus = 1;\n        }\n\n        if (t2 < t1) {\n          form3.participateStatus = 2;\n        }\n\n        form3.signAdress = localStorage.getItem(\"location\");\n\n        if (this.form.participateStatus === 0) {\n          this.request.post(\"/AboutMeeting/manualSign\", form3).then(res => {\n            if (res.code === '200') {\n              this.$message.success(\"签到成功\");\n\n              if (this.form.createUser === this.user.id) {\n                this.$message.success(\"创建成功\");\n                this.$router.push({\n                  name: \"theMeeting\",\n                  params: {\n                    meetingName: form3.meetingName,\n                    meetingId: form3.meetingId,\n                    roomId: form3.code,\n                    udid: form3.udid\n                  }\n                });\n              } else {\n                this.$message.success(\"加入成功\");\n                this.$router.push({\n                  name: \"theMeeting\",\n                  params: {\n                    meetingName: form3.meetingName,\n                    meetingId: form3.meetingId,\n                    roomId: form3.code,\n                    udid: form3.udid,\n                    qwq: 1\n                  }\n                });\n              } // this.form.checkStatus = 1\n\n            } else {\n              this.$message.error(\"签到失败\");\n            }\n          });\n        } else {\n          this.$message.error(\"您已签到,请勿重复签到！\");\n\n          if (this.form.createUser === this.user.id) {\n            this.$message.success(\"创建成功\");\n            this.$router.push({\n              name: \"theMeeting\",\n              params: {\n                meetingName: form3.meetingName,\n                meetingId: form3.meetingId,\n                roomId: form3.code,\n                udid: form3.udid,\n                qwq: 1\n              }\n            });\n          } else {\n            this.$message.success(\"加入成功\");\n            this.$router.push({\n              name: \"theMeeting\",\n              params: {\n                meetingName: form3.meetingName,\n                meetingId: form3.meetingId,\n                roomId: form3.code,\n                udid: form3.udid\n              }\n            });\n          }\n        }\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":"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2C,eAFA;UAGAC;QAHA;MAIA;IACA,CAzOA;;IA4OA;IACA;IACAC;MACA;QACA;UACAC,qDADA,CACA;;UACA;QACA,CAHA,MAIA;UACA;QAEA;MACA,CATA,MAUA;QACA;UACA;UACA;QAEA;;QACA;UACA;UACA;QACA;MACA;IAEA,CArQA;;IAsQA;IACAC;MACAC,uBACAC,YADA,CACA;QACAC,WADA;QACAC;UAAAC;UAAAC;QAAA;MADA,CADA,EAIA7B,IAJA,CAIA8B;QACA;QACA,wCAFA,CAEA;QACA;;QACA;;QACA;;QACA1B;UACA2B;QACA,CAFA,EAEA,IAFA;MAGA,CAbA,EAcAC,KAdA,CAcA;QACA,qBADA,CAEA;;QACA;QACA;QACA;MACA,CApBA;IAsBA,CA9RA;;IAgSAC;MACA;MACA,sCAFA,CAEA;;MACA,gCAHA,CAGA;;MACA;MACA;MACA;;MACA;QACAC;MACA;;MACA;QACA1D;MADA;IAGA,CA7SA;;IA8SA;IACA2D;MACA,sDADA,CAEA;;MACAC,yDAHA,CAKA;;MACA;MACA;MACA;MACAC;MACA;MACAC;MACA;MACAC,0BACAvC,IADA,CACAC;QACA;QACA;;QACA;UACA;UACA;UACA;YACAuC,kBADA;YAEAzC,8BAFA;YAGAS;UAHA;UAKAiC,kDARA,CASA;;UACA;;UACA;YACAA;UACA;;UACA;YACAA;UACA;;UACA;YACAC,qDACA1C,IADA,CACAC;cACA;gBACAyC;;gBACA;kBACAA;kBACAA;oBACA5G,kBADA;oBAEAgE;sBACA6C,4BADA;sBAEA5C,8BAFA;sBAGA6C,sBAHA;sBAIAC,oBAJA;sBAKAC;oBALA;kBAFA;gBAUA,CAZA,MAYA;kBACAJ;kBACAA;oBACA5G,kBADA;oBAEAgE;sBACA6C,4BADA;sBAEA5C,8BAFA;sBAGA8C,oBAHA;sBAIAD;oBAJA;kBAFA;gBASA;cACA;YAAA,CA5BA;UA4BA,CA7BA,MA8BA;YACAF;;YACA;cACAA;cACAA;gBACA5G,kBADA;gBAEAgE;kBACA6C,4BADA;kBAEA5C,8BAFA;kBAGA6C,sBAHA;kBAIAC,oBAJA;kBAKAC;gBALA;cAFA;YAUA,CAZA,MAaA;cACAJ;cACAA;gBACA5G,kBADA;gBAEAgE;kBACA6C,4BADA;kBAEA5C,8BAFA;kBAGA6C,sBAHA;kBAIAC;gBAJA;cAFA;YASA;UAAA;QACA,CA1EA,MA0EA;UACA;UACAH;UACAA;;UACA;YACAA;YACAA;UACA;QAEA;MACA,CAxFA,EAyFAV,KAzFA,CAyFAe;QACA;QACA;QACA;;QACA;UACA;UACA;QACA;MACA,CAjGA;IAkGA,CA9ZA;;IA+ZAC;MACA;IACA,CAjaA;;IAkaAC;MAEA,8CACA;QACAnD;UACAlD,WADA;UAEAD,UAFA;UAGA6D,oBAHA;UAIAD;QAJA;MADA,CADA,EAQAP,IARA,CAQAC;QACA;UACAuC,cADA;UAEAK,gBAFA;UAGA9C,2BAHA;UAIAS,oBAJA;UAKAD,iBALA;UAMAoC;QANA;QAQA;QACAF;QAEA;;QACA;UACAA;QACA;;QACA;UACAA;QACA;;QACAA;;QAEA;UACA,qDACAzC,IADA,CACAC;YACA;cACA;;cACA;gBACA;gBACA;kBACAnE,kBADA;kBAEAgE;oBACA6C,8BADA;oBAEA5C,0BAFA;oBAGA6C,kBAHA;oBAIAC;kBAJA;gBAFA;cASA,CAXA,MAYA;gBACA;gBACA;kBACA/G,kBADA;kBAEAgE;oBACA6C,8BADA;oBAEA5C,0BAFA;oBAGA6C,kBAHA;oBAIAC,gBAJA;oBAKAC;kBALA;gBAFA;cAUA,CA1BA,CA2BA;;YACA,CA5BA,MA4BA;cACA;YACA;UACA,CAjCA;QAiCA,CAlCA,MAmCA;UAEA;;UACA;YACA;YACA;cACAhH,kBADA;cAEAgE;gBACA6C,8BADA;gBAEA5C,0BAFA;gBAGA6C,kBAHA;gBAIAC,gBAJA;gBAKAC;cALA;YAFA;UAUA,CAZA,MAaA;YACA;YACA;cACAhH,kBADA;cAEAgE;gBACA6C,8BADA;gBAEA5C,0BAFA;gBAGA6C,kBAHA;gBAIAC;cAJA;YAFA;UASA;QACA;MACA,CA7FA;IAiGA;;EArgBA;AAlDA","names":["name","components","Editor","Toolbar","Map","children","path","data","user","mid","theface","activeName","tableData","pageNum","pageSize","dialogTables","dialogTableVisible","dialogTable","form","getData","information","Allnum","Earlynum","LATERnum","Alrnum","mename","allmeeting","rate","faceIn","meeting","downloadLoading","Nums","created","methods","drawLine","title","text","size","left","tooltip","trigger","xAxis","type","yAxis","series","option","myChart","drawBar","echarts","legend","top","radius","avoidLabelOverlap","itemStyle","borderRadius","borderColor","borderWidth","label","show","position","emphasis","fontSize","fontWeight","labelLine","params","meetingId","then","res","value","open","setTimeout","t","load","code","userId","myMeeting","MeetingInformation","MeetingDetail","exp","excel","handleSizeChange","handleCurrentChange","meetingHandle","confirmButtonText","cancelButtonText","showClose","message","joinMeeting","localStorage","openPhoto","navigator","getUserMedia","audio","video","width","height","success","_this","catch","base64toFile","u8arr","photograph","photoInfo","string","formData","axios","id","form3","that","meetingName","roomId","udid","qwq","err","cback","sign"],"sourceRoot":"src/views","sources":["tabMyMeeting.vue"],"sourcesContent":["<template>\r\n<div class=\"MyMeeting\">\r\n  <el-table :data=\"tableData\"   stripe style=\"width: 100%;margin-bottom: 10px\">\r\n\r\n    <el-table-column\r\n        fixed prop=\"startDate\" label=\"开始时间\" width=\"200\"  sortable>\r\n    </el-table-column>\r\n\r\n\r\n    <el-table-column\r\n        prop=\"name\" label=\"会议主题\" align=\"center\" min-width=\"250\" width=\"auto\">\r\n      <template slot-scope=\"scope\">\r\n        <a @click=\"MeetingDetail(scope.row)\" style=\"color: #409eff;cursor:pointer\">{{scope.row.name}}</a>\r\n      </template>\r\n    </el-table-column>\r\n\r\n    <el-table-column\r\n        prop=\"code\" label=\"会议号\" width=\"130\">\r\n    </el-table-column>\r\n\r\n    <el-table-column\r\n        prop=\"participateStatus\" width=\"130\" label=\"会议情况\"  align=\"center\">\r\n      <template slot-scope=\"scope\">\r\n        <el-tag size=\"small\"  v-if=\"scope.row.status === 0\"  type=\"info \" >线下</el-tag>\r\n        <el-tag size=\"small\" v-else-if=\"scope.row.status === 1\"  >线上</el-tag>\r\n      </template>\r\n    </el-table-column>\r\n\r\n    <el-table-column\r\n        prop=\"participateStatus\" label=\"签到情况\" width=\"130\" align=\"center\">\r\n      <template slot-scope=\"scope\">\r\n        <el-tag size=\"small\"  v-if=\"scope.row.participateStatus === 0\"  type=\"info \" >未签到</el-tag>\r\n        <el-tag size=\"small\" v-else-if=\"scope.row.participateStatus === 1\"  >已签到</el-tag>\r\n        <el-tag size=\"small\" v-else-if=\"scope.row.participateStatus === 2\" type=\"warning\" effect=\"dark\">迟到</el-tag>\r\n        <el-tag size=\"small\" v-else-if=\"scope.row.participateStatus === 3\" type=\"warning\" effect=\"dark\">早退</el-tag>\r\n      </template>\r\n    </el-table-column>\r\n\r\n    <el-table-column\r\n        prop=\"stage\" label=\"会议状态\" width=\"130\" align=\"center\">\r\n      <template slot-scope=\"scope\">\r\n        <el-tag size=\"small\"  v-if=\"scope.row.stage === 0\"  >未开启</el-tag>\r\n        <el-tag size=\"small\" v-else-if=\"scope.row.stage === 1\" type=\"warn\" effect=\"dark\">进行中</el-tag>\r\n        <el-tag size=\"small\" v-else-if=\"scope.row.stage === 2\" type=\"info\" effect=\"dark\">已结束</el-tag>\r\n      </template>\r\n    </el-table-column>\r\n\r\n\r\n    <el-table-column prop=\"city\" width=\"200\" label=\"操作\" align=\"center\">\r\n      <template slot-scope=\"scope\">\r\n        <el-button type=\"text\" @click=\"meetingHandle(scope.row)\" >进入会议</el-button>\r\n\r\n<!--        <el-divider direction=\"vertical\"></el-divider>-->\r\n<!--        <el-button type=\"text\" @click=\"MeetingMember(scope.row)\">参会人员</el-button>-->\r\n        <el-divider direction=\"vertical\"></el-divider>\r\n        <el-button type=\"text\" @click=\"MeetingInformation(scope.row)\">数据统计</el-button>\r\n      </template>\r\n    </el-table-column>\r\n\r\n\r\n  </el-table>\r\n\r\n\r\n  <el-dialog title=\"人脸识别签到\" :visible.sync=\"theface\" >\r\n\r\n    <div class=\"container\">\r\n      <!-- 开启摄像头 -->\r\n      <!-- <el-button size=\"mini\" @click=\"openPhoto\">摄像头</el-button> -->\r\n      <!-- canvas 截取流 -->\r\n      <canvas ref=\"canvas\" width=\"500\" height=\"500\" style=\"display: none;\"></canvas>\r\n      <!-- 图片展示 -->\r\n      <div class=\"renlian-container\">\r\n        <div class=\"renlian\">\r\n          <video ref=\"video\" muted autoplay playsinline></video>\r\n          <div class=\"anim mins\"></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </el-dialog>\r\n\r\n  <!--    手动签到弹窗-->\r\n  <el-dialog title=\"手动签到\"  :visible.sync=\"dialogTable\">\r\n    <Map></Map>\r\n\r\n    <div style=\"z-index: 1;position: relative;left: 36%;top: 10px;\">\r\n      <el-button style=\"margin-right: 60px\" @click=\"cback\">返回</el-button>\r\n      <el-button type=\"primary\" @click=\"sign()\">签到</el-button>\r\n    </div>\r\n\r\n  </el-dialog>\r\n\r\n\r\n\r\n  <div CLASS=\"MeetingInformation\">\r\n    <el-dialog title=\"数据统计\" @open=\"open()\" destroy-on-close :visible.sync=\"dialogTables\" width=\"960px\" >\r\n      <el-divider></el-divider>\r\n\r\n      <el-row :gutter=\"10\" style=\"margin-bottom: 30px\">\r\n        <el-col :span=\"6\" style=\"padding-left: 25px; padding-right: 5px;\">\r\n          <el-card>\r\n            <div style=\"color:rgb(135 191 143)\"><i class=\"el-icon-star-off\"></i>\r\n              系统会议数目\r\n            </div>\r\n            <div style=\"padding: 10px 0;text-align: center;font-weight: bold\">\r\n              {{allmeeting}}\r\n            </div>\r\n          </el-card>\r\n        </el-col>\r\n\r\n\r\n\r\n        <el-col :span=\"6\" style=\"padding-right: 25px;\" >\r\n          <el-card>\r\n            <div style=\"color: rgb(135 191 143)\"><icon class=\"el-icon-user\"> </icon>\r\n              系统参会总数\r\n            </div>\r\n            <div style=\"padding: 10px 0;text-align: center;font-weight: bold\">\r\n              {{information.Allnum}}\r\n            </div>\r\n          </el-card>\r\n        </el-col>\r\n\r\n\r\n\r\n        <el-col :span=\"6\" style=\"padding-left: 30px;padding-right: 0px\">\r\n          <el-card>\r\n            <div style=\"color: #409eff\"><i CLASS=\"el-icon-user-solid\"></i>\r\n              该会参会人数\r\n            </div>\r\n            <div style=\"padding: 10px 0;text-align: center;font-weight: bold\">\r\n              {{Nums}}\r\n            </div>\r\n          </el-card>\r\n        </el-col>\r\n\r\n\r\n        <el-col :span=\"6\" style=\"padding-left: 10px; padding-right: 20px;\">\r\n          <el-card>\r\n            <div style=\"color: #409eff\"><i CLASS=\"el-icon-success\"></i>\r\n              该会议签到率\r\n            </div>\r\n            <div style=\"padding: 10px 0;text-align: center;font-weight: bold\">\r\n              {{rate}}%\r\n            </div>\r\n          </el-card>\r\n        </el-col>\r\n      </el-row>\r\n      <el-row :gutter=\"5\">\r\n        <el-col :span=\"12\">\r\n          <div id=\"main\" style=\"width: 500px;height: 450px\"></div>\r\n        </el-col>\r\n        <el-col :span=\"12\">\r\n          <div id=\"pie\" style=\"width: 500px;height: 460px\"></div>\r\n        </el-col>\r\n      </el-row>\r\n    </el-dialog>\r\n  </div>\r\n\r\n\r\n  <el-dialog title=\"会议详情\"  :visible.sync=\"dialogTableVisible\">\r\n\r\n    <template slot-scope=\"scope\">\r\n\r\n<!--form类型的会议详情-->\r\n      <div class=\"detail\">\r\n        <el-form :model=\"form\" label-width=\"130px\"   style=\"padding-right: 15px\" >\r\n          <el-form-item label=\"会议主题 :\" prop=\"name\">\r\n            <el-input readonly v-model=\"form.name\"  style=\"width: 55%;font-size: large\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"会议时间 :\" >\r\n            <el-col :span=\"5\" >\r\n              <el-date-picker\r\n                  readonly\r\n                  v-model=\"form.startDate\"\r\n                  type=\"datetime\"\r\n                 >\r\n              </el-date-picker>\r\n            </el-col>\r\n            <el-col class=\"line\" :span=\"6\" style=\"position: relative;left:17%\" >  ——> </el-col>\r\n            <el-col :span=\"5\">\r\n              <el-date-picker\r\n                  readonly\r\n                  v-model=\"form.endDate\"\r\n                  type=\"datetime\"\r\n              >\r\n              </el-date-picker>\r\n            </el-col>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"会议号 :\" prop=\"code\" >\r\n            <el-input v-model=\"form.code\" style=\"width: 55%\"> </el-input>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"会议情况 :\" prop=\"status\" >\r\n            <el-tag size=\"small\"  v-if=\"form.status === 0\" style=\"left: 14px;height: 36px;font-size:large;position: relative\" >线下</el-tag>\r\n            <el-tag size=\"small\" v-else-if=\"form.status === 1\" style=\"left: 14px;height: 36px;font-size:large;position: relative\" >线上</el-tag>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"审核情况 :\" prop=\"show\" >\r\n             <el-tag size=\"small\"  style=\"padding-left: 10px\" v-if=\"form.show === 0\" >未审核</el-tag>\r\n             <el-tag size=\"small\"   style=\"left: 14px;height: 36px;font-size:large;position: relative\" v-else-if=\"form.show === 1\" >已通过</el-tag>\r\n             <el-tag size=\"small\"  v-else-if=\"form.show === 2\" >未通过</el-tag>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"会议地址 :\" prop=\"address\">\r\n            <el-input v-model=\"form.address\" style=\"width: 75%\"></el-input>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"创建时间 :\" prop=\"code\">\r\n            <el-input v-model=\"form.createTime\" style=\"width: 45%\"> </el-input>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"会议简介 :\" prop=\"address\" >\r\n          <div>\r\n            <div v-html=\"form.description\" style=\"left: 2%;position: relative; \"></div>\r\n          </div>\r\n          </el-form-item>\r\n        </el-form>\r\n      </div>\r\n    </template>\r\n  </el-dialog>\r\n\r\n  <div style=\"margin-top: 10px;position: relative;left: 35%\">\r\n    <el-pagination\r\n        @size-change=\"handleSizeChange\"\r\n        @current-change=\"handleCurrentChange\"\r\n        :current-page=\"pageNum\"\r\n        :page-sizes=\"[8]\"\r\n        :page-size=\"pageSize\"\r\n        background\r\n        layout=\"  prev,sizes, pager, next, jumper\"\r\n        >\r\n    </el-pagination>\r\n  </div>\r\n\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as echarts from 'echarts'\r\nimport {Editor, Toolbar} from \"@wangeditor/editor-for-vue\";\r\nimport Map from \"@/views/Map\";\r\nimport moment from \"moment\";\r\nimport axios from 'axios'\r\nexport default {\r\n  name: \"tabMyMeeting\",\r\n  components: {\r\n    Editor, Toolbar, Map\r\n  },\r\n  children: [\r\n    {\r\n      name:'Map',\r\n      path:'Map',\r\n      components: Map\r\n    },\r\n  ],\r\n  data() {\r\n    return {\r\n      user:{},\r\n      mid:'',\r\n      theface:false,\r\n      activeName: \"first\",\r\n      tableData: [],\r\n      pageNum: 1,\r\n      pageSize: 8,\r\n      dialogTables:false,\r\n      dialogTableVisible: false,\r\n      dialogTable:false,\r\n      form: {},\r\n      getData:[],\r\n      information:{},\r\n      Allnum:'',\r\n      Earlynum:'',\r\n      LATERnum:'',\r\n      Alrnum:'',\r\n      mename:'',\r\n      allmeeting:'',\r\n      rate:'',\r\n      faceIn:1,\r\n      meeting:[],\r\n      downloadLoading: false,\r\n      Nums:''\r\n    };\r\n  },\r\n\r\n\r\n  created() {\r\n    //请求分页查询数据\r\n    this.user=  JSON.parse(localStorage.getItem(\"user\"))\r\n    this.load()\r\n  },\r\n\r\n\r\n\r\n  methods: {\r\n\r\n\r\n    drawLine() {\r\n\r\n      let chartDom = document.getElementById('main');\r\n      let myChart = echarts.init(chartDom);\r\n      var option = {\r\n        title:{\r\n          text:'各季度会议展开情况',\r\n          size:'large',\r\n          left: 'center'\r\n        },\r\n        tooltip: {\r\n          trigger: 'item'\r\n        },\r\n        xAxis: {\r\n          type: 'category',\r\n          data: [\"第一季度\",\"第二季度\",\"第三季度\",\"第四季度\"]\r\n        },\r\n        yAxis: {\r\n          type: 'value'\r\n        },\r\n        series: [\r\n          {\r\n            data: [],\r\n            type: 'line'\r\n          },\r\n          {\r\n            data: [],\r\n            type: 'bar'\r\n          }\r\n        ]\r\n      };\r\n\r\n      this.request.get(\"/echarts/members\").then(res=>{\r\n        this.allmeeting=res.data[0]+res.data[1]+res.data[2]+res.data[3]\r\n        option.series[0].data= res.data\r\n        option.series[1].data= res.data\r\n        myChart.setOption(option);\r\n            })\r\n\r\n    },\r\n    drawBar(){\r\n      echarts.init( document.getElementById('pie'));\r\n      let myChart = echarts.init(document.getElementById('pie'));\r\n      const option = {\r\n        title:{\r\n          text:'该会议人员参会情况',\r\n          size:'large',\r\n          left: 'center'\r\n        },\r\n        tooltip: {\r\n          trigger: 'item'\r\n        },\r\n        legend: {\r\n          top: '5%',\r\n          left: 'center'\r\n        },\r\n        series: [\r\n          {\r\n            name: '该会议人员参会情况',\r\n            type: 'pie',\r\n            radius: ['40%', '70%'],\r\n            avoidLabelOverlap: false,\r\n            itemStyle: {\r\n              borderRadius: 10,\r\n              borderColor: '#fff',\r\n              borderWidth: 2\r\n            },\r\n            label: {\r\n              show: false,\r\n              position: 'center'\r\n            },\r\n            emphasis: {\r\n              label: {\r\n                show: true,\r\n                fontSize: '40',\r\n                fontWeight: 'bold'\r\n              }\r\n            },\r\n            labelLine: {\r\n              show: false\r\n            },\r\n            data:[]\r\n          }\r\n        ]\r\n      };\r\n      this.request.get(\"/echarts/hello\",\r\n          {\r\n        params: {\r\n          meetingId:this.mid\r\n        }}\r\n      ).then(res=>{\r\n        this.rate=(res.data[0].value/this.Nums).toFixed(2)*100\r\n        option.series[0].data= res.data\r\n        option.series[0].data.push({name:'未签到',value:this.Nums-res.data[0].value-res.data[1].value-res.data[2].value})\r\n        myChart.setOption(option);\r\n      })\r\n    },\r\n\r\n    open() {\r\n      const t = this;\r\n      setTimeout(() => {\r\n        //  执行echarts画图方法\r\n          t.drawBar();\r\n          t.drawLine();\r\n\r\n\r\n      },0)\r\n    },\r\n\r\n\r\n    load() {\r\n      this.request.get(\"/AboutMeeting/findMeeting\", {\r\n        params: {\r\n          pageNum: this.pageNum,\r\n          pageSize: this.pageSize,\r\n          code: this.code,\r\n          userId: this.user.id,\r\n          myMeeting:1\r\n        }\r\n\r\n      }).then(res => {\r\n            this.tableData = res\r\n          }\r\n      )\r\n    },\r\n\r\n\r\n    MeetingInformation(row){\r\n      this.mid=row.meetingId\r\n      this.mename=row.name\r\n      this.request.get(\"/AboutMeeting/findMember\", {\r\n        params: {\r\n          pageNum: 1,\r\n          pageSize: 100,\r\n          code:row.code\r\n        }\r\n      }).then(res => {\r\n            this.Nums=res.data.total\r\n          }\r\n      )\r\n\r\n      this.dialogTables = true\r\n      this.request.get(\"/echarts\",{\r\n        params:{\r\n          meetingId:row.meetingId\r\n\r\n        }\r\n      }).then(res =>{\r\n            this.information=res.data\r\n            this.meeting.meetingId=row.meetingId\r\n          }\r\n      )\r\n\r\n    },\r\n\r\n    MeetingDetail(row){\r\n      this.form=row\r\n      this.dialogTableVisible = true\r\n    },\r\n    exp(){\r\n      this.downloadLoading = true\r\n      import('@/utils/Export2Excel.js').then(excel => {\r\n        const tHeader = ['会议号', '用户编号', '用户姓名', '签到情况', '签到时间','签退时间']\r\n        const filterVal = ['code', 'userId', 'uname', 'participateStatus', 'signInDate','signOutDate']\r\n        excel.export_json_to_excel2(tHeader, this.getData, filterVal, this.mename+'参会人员信息')\r\n        this.downloadLoading = false\r\n      })\r\n\r\n    },\r\n    handleSizeChange(pageSize) {\r\n\r\n      this.pageSize = pageSize\r\n      this.load()\r\n    },\r\n    handleCurrentChange(pageNum) {\r\n      this.pageNum = pageNum\r\n      this.load()\r\n    },\r\n    meetingHandle(row){\r\n      if (row.stage === 1 && row.show === 1) {\r\n        this.$confirm('将于现在进入【' + row.name + '】会议, 是否确带继续?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.request.get(\"/AboutMeeting/join\", {\r\n                params: {\r\n                  code: row.code,\r\n                  userId: this.user.id\r\n                }\r\n              }\r\n          ).then(res => {\r\n                if (res.code === '200') {\r\n                  this.form = res.data\r\n\r\n                }\r\n                else{\r\n                  this.$message({\r\n                    type:'error',\r\n                    showClose: true,\r\n                    message: '有误！'})\r\n                }\r\n              }\r\n\r\n          )\r\n\r\n          this.joinMeeting(row);\r\n\r\n\r\n        })\r\n\r\n      }\r\n      else if(row.stage === 2){\r\n        this.$message({\r\n          type:'error',\r\n          showClose: true,\r\n          message: '会议已结束！'})\r\n      }\r\n      else if(row.stage === 0){\r\n        this.$message({\r\n          type:'warning',\r\n          showClose: true,\r\n          message: '会议还未开始！'})\r\n      }\r\n      else {\r\n        this.$message({\r\n          type:'error',\r\n          showClose: true,\r\n          message: '还未通过审核！'})\r\n      }\r\n    },\r\n\r\n\r\n    // ----------------------------------人脸识别模块-----------------------------------------\r\n    // 开始会议\r\n    joinMeeting(row){\r\n      if (row.status===0){\r\n        if (row.createUser===this.user.id){\r\n          localStorage.setItem(\"meeting\", JSON.stringify(row))  // 存储用户信息到浏览器\r\n          this.$router.push(\"/AllSign\")\r\n        }\r\n        else {\r\n          this.$message.error(\"您无权操作！\")\r\n\r\n        }\r\n      }\r\n      else {\r\n        if(this.faceIn===1){\r\n          this.theface=true\r\n          this.openPhoto()\r\n\r\n        }\r\n        if(this.faceIn===0){\r\n          this.dialogTable=true\r\n          this.faceIn=1\r\n        }\r\n      }\r\n\r\n    },\r\n    //人脸识别\r\n    openPhoto() {\r\n      navigator.mediaDevices\r\n          .getUserMedia({\r\n            audio: true, video: { width: 720, height: 720 }\r\n          })\r\n          .then((success) => {\r\n            // 摄像头开启成功\r\n            this.$refs[\"video\"].srcObject = success; //srcObject 是实时流\r\n            // 实时拍照效果\r\n            this.$refs[\"video\"].play();\r\n            let _this=this\r\n            setTimeout(function()  {\r\n              _this.photograph()\r\n            }, 1140);\r\n          })\r\n          .catch(() => {\r\n            this.theface=false\r\n            //摄像头开启失败\r\n            this.$message.error(\"识别失败！即将进行手动签到\")\r\n            this.dialogTable=true\r\n            this.faceIn=1\r\n          });\r\n\r\n    },\r\n\r\n    base64toFile (dataBase64, filename = 'file') {\r\n      let arr = dataBase64.split(',')\r\n      let mime = arr[0].match(/:(.*?);/)[1]  //设置file⽂件流的type名称\r\n      let suffix = mime.split('/')[1]  //设置file⽂件流的name名称\r\n      const bstr = window.atob(arr[1]);\r\n      let n = bstr.length\r\n      const u8arr = new Uint8Array(n)\r\n      while (n--) {\r\n        u8arr[n] = bstr.charCodeAt(n)\r\n      }\r\n      return new File([u8arr], `${filename}.${suffix}`, {\r\n        type: mime\r\n      })\r\n    },\r\n    // 拍照\r\n    photograph() {\r\n      let photoInfo= this.$refs[\"canvas\"].getContext(\"2d\");\r\n      // 把当前内容渲染到canvas上\r\n      photoInfo.drawImage(this.$refs[\"video\"], 0, 0, 480, 480);\r\n\r\n      // //canvas图片 转base64格式、图片格式转换、图片质量压缩\r\n      let img = this.$refs[\"canvas\"].toDataURL(\"image/jpg\");\r\n      let imgBase64 = this.$refs[\"canvas\"].toDataURL(\"image/jpg\", 0.7);\r\n      let string = imgBase64.replace(\"data:image/jpg;base64,\", \"\");\r\n      string=this.base64toFile(imgBase64, 'camera');\r\n      let formData=new FormData()\r\n      formData.append('image',string)\r\n      var url = 'https://xiaoku.store:5000/recognition'\r\n      axios.post(url, formData)\r\n          .then(res => {\r\n            //人脸识别成功\r\n            let that= this\r\n            if (res.data.results[0].username===this.user.name){\r\n              //签到信息\r\n              let t1=moment().startOf('millisecond').format(\"YYYY-MM-DD HH:mm:ss\")\r\n              const form3= {\r\n                id:that.form.udid,\r\n                meetingId:that.form.meetingId,\r\n                userId:that.user.id\r\n              }\r\n              form3.signInDate=JSON.parse(JSON.stringify(t1))\r\n              // this.form.udid=form3.id\r\n              let t2= moment(that.form.startDate).format(\"YYYY-MM-DD HH:mm:ss\")\r\n              if ( t2 >= t1 ){\r\n                form3.participateStatus=1\r\n              }\r\n              if  (t2 < t1) {\r\n                form3.participateStatus=2\r\n              }\r\n              if (that.form.participateStatus===0){\r\n                that.request.post(\"/AboutMeeting/manualSign\",form3)\r\n                    .then(res => {\r\n                      if (res.code === '200') {\r\n                        that.$message.success(\"签到成功\")\r\n                        if (that.form.createUser === that.user.id) {\r\n                          that.$message.success(\"创建成功\")\r\n                          that.$router.push({\r\n                            name: \"theMeeting\",\r\n                            params: {\r\n                              meetingName: that.form.mname,\r\n                              meetingId: that.form.meetingId,\r\n                              roomId: that.form.code,\r\n                              udid: that.form.udid,\r\n                              qwq: 1\r\n                            }\r\n                          })\r\n                        } else {\r\n                          that.$message.success(\"加入成功\")\r\n                          that.$router.push({\r\n                            name: \"theMeeting\",\r\n                            params: {\r\n                              meetingName: that.form.mname,\r\n                              meetingId: that.form.meetingId,\r\n                              udid: that.form.udid,\r\n                              roomId: that.form.code\r\n                            }\r\n                          })\r\n                        }\r\n                      }})}\r\n              else{\r\n                that.$message.error(\"您已签到,请勿重复签到！\")\r\n                if(that.form.createUser===that.user.id){\r\n                  that.$message.success(\"创建成功\")\r\n                  that.$router.push({\r\n                    name: \"theMeeting\",\r\n                    params:{\r\n                      meetingName: that.form.mname,\r\n                      meetingId:that.form.meetingId,\r\n                      roomId:that.form.code,\r\n                      udid:that.form.udid,\r\n                      qwq:1\r\n                    }\r\n                  })\r\n                }\r\n                else{\r\n                  that.$message.success(\"加入成功!\")\r\n                  that.$router.push({\r\n                    name: \"theMeeting\",\r\n                    params:{\r\n                      meetingName: that.form.mname,\r\n                      meetingId:that.form.meetingId,\r\n                      roomId:that.form.code,\r\n                      udid:that.form.udid\r\n                    }\r\n                  })\r\n                }}\r\n            }else {\r\n              this.theface=false\r\n              that.$message.error(\"识别失败！即将进行手动签到\")\r\n              that.faceIn=0\r\n              if(that.faceIn===0){\r\n                that.dialogTable=true\r\n                that.faceIn=1\r\n              }\r\n\r\n            }\r\n          })\r\n          .catch(err => {\r\n            this.theface=false\r\n            this.$message.error(\"识别失败！即将进行手动签到\")\r\n            this.faceIn=0\r\n            if(this.faceIn===0){\r\n              this.dialogTable=true\r\n              this.faceIn=1\r\n            }\r\n          })\r\n    },\r\n    cback(){\r\n      this.dialogTable=false\r\n    },\r\n    sign(){\r\n\r\n      this.request.get(\"/AboutMeeting/findMeeting\",\r\n          {\r\n            params: {\r\n              pageSize:1,\r\n              pageNum:1,\r\n              userId:this.user.id,\r\n              code:this.form.code\r\n            }}\r\n      ).then(res => {\r\n        const form3= {\r\n          id:res[0].uid,\r\n          udid:res[0].uid,\r\n          meetingId:res[0].meetingId,\r\n          userId:this.user.id,\r\n          code:res[0].code,\r\n          meetingName:res[0].name\r\n        }\r\n        let t1=moment().startOf('millisecond').format(\"YYYY-MM-DD HH:mm:ss\")\r\n        form3.signInDate=JSON.parse(JSON.stringify(t1))\r\n\r\n        let t2= moment(this.form.startDate).format(\"YYYY-MM-DD HH:mm:ss\")\r\n        if ( t2 >= t1 ){\r\n          form3.participateStatus=1\r\n        }\r\n        if  (t2 < t1) {\r\n          form3.participateStatus=2\r\n        }\r\n        form3.signAdress=localStorage.getItem(\"location\");\r\n\r\n        if (this.form.participateStatus===0){\r\n          this.request.post(\"/AboutMeeting/manualSign\",form3)\r\n              .then(res => {\r\n                if (res.code === '200') {\r\n                  this.$message.success(\"签到成功\")\r\n                  if(this.form.createUser===this.user.id){\r\n                    this.$message.success(\"创建成功\")\r\n                    this.$router.push({\r\n                      name: \"theMeeting\",\r\n                      params:{\r\n                        meetingName: form3.meetingName,\r\n                        meetingId:form3.meetingId,\r\n                        roomId:form3.code,\r\n                        udid:form3.udid,\r\n                      }\r\n                    })\r\n                  }\r\n                  else{\r\n                    this.$message.success(\"加入成功\")\r\n                    this.$router.push({\r\n                      name: \"theMeeting\",\r\n                      params:{\r\n                        meetingName: form3.meetingName,\r\n                        meetingId:form3.meetingId,\r\n                        roomId:form3.code,\r\n                        udid:form3.udid,\r\n                        qwq:1\r\n                      }\r\n                    })\r\n                  }\r\n                  // this.form.checkStatus = 1\r\n                } else {\r\n                  this.$message.error(\"签到失败\")\r\n                }\r\n              })}\r\n        else{\r\n\r\n          this.$message.error(\"您已签到,请勿重复签到！\")\r\n          if(this.form.createUser===this.user.id){\r\n            this.$message.success(\"创建成功\")\r\n            this.$router.push({\r\n              name: \"theMeeting\",\r\n              params:{\r\n                meetingName: form3.meetingName,\r\n                meetingId:form3.meetingId,\r\n                roomId:form3.code,\r\n                udid:form3.udid,\r\n                qwq:1\r\n              }\r\n            })\r\n          }\r\n          else{\r\n            this.$message.success(\"加入成功\")\r\n            this.$router.push({\r\n              name: \"theMeeting\",\r\n              params:{\r\n                meetingName: form3.meetingName,\r\n                meetingId:form3.meetingId,\r\n                roomId:form3.code,\r\n                udid:form3.udid\r\n              }\r\n            })\r\n          }\r\n        }\r\n      })\r\n\r\n\r\n\r\n    },\r\n\r\n\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.el-tag--small {\r\n  height: 33px;\r\n  padding: 4px 9px;\r\n  line-height: 22px;\r\n  font-size: initial;\r\n}\r\n\r\n::v-deep .el-table__fixed {\r\n  height: 100% !important;\r\n\r\n  }\r\n::v-deep .detail .el-input__inner {\r\n  border: 1px solid #ffffff;\r\n  font-size: large;\r\n  font-family: 微软雅黑;\r\n  width: 245px;\r\n}\r\n::v-deep .el-input__inner:hover {\r\n  border-color: #ffffff;\r\n}\r\n::v-deep  .el-form-item__label {\r\n  font-size: large;\r\n}\r\n\r\n::v-deep .el-dialog__title {\r\n  line-height: 41px;\r\n  font-size: 20px;\r\n  padding-left: 10px;\r\n  color: #000000;\r\n}\r\n\r\n::v-deep .MeetingMember  .el-dialog__body {\r\n  padding: 3px 20px 10px 43px;\r\n}\r\n::v-deep .MeetingInformation .el-dialog__body {\r\npadding-top:0;\r\n}\r\n\r\n\r\n\r\n.container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n\r\n.renlian-container {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.renlian {\r\n  background: #303133;\r\n  border-radius: 50%;\r\n  border: 5px solid #909399;\r\n  overflow: hidden;\r\n  width: 80%; /* 使用百分比宽度，确保自适应 */\r\n  max-width: 477px; /* 保持最大尺寸 */\r\n  aspect-ratio: 1; /* 保持宽高比为1，确保是圆形 */\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  position: relative;\r\n}\r\n\r\nvideo {\r\n  width: 100%;\r\n  min-height: 100%;\r\n\r\n  height: 100%;\r\n  object-fit: cover;\r\n  transform: rotateY(180deg);\r\n  -moz-transform: rotateY(180deg);\r\n}\r\n\r\n.anim.mins {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 50%;\r\n  box-shadow: inset 0px 0px 0px 18px #ff1010c7;\r\n  animation: idea 3s infinite linear;\r\n}\r\n\r\n@keyframes idea {\r\n  100%{\r\n    -webkit-clip-path: polygon(100% 0%, 100% 100%, 0% 100%, 0% 0%, 100% 0%, 50% 50%, 50% 0%);\r\n  }\r\n  87.5% {\r\n    -webkit-clip-path: polygon(100% 0%, 100% 100%, 0% 100%, 0% 0%, 50% 0%, 50% 50%, 50% 0%);\r\n  }\r\n  75% {\r\n    -webkit-clip-path: polygon(100% 0%, 100% 100%, 0% 100%, 0% 50%, 0% 50%, 50% 50%, 50% 0%);\r\n  }\r\n  62.5% {\r\n    -webkit-clip-path: polygon(100% 0%, 100% 100%, 0% 100%, 0% 100%, 0% 100%, 50% 50%, 50% 0%);\r\n  }\r\n  50% {\r\n    -webkit-clip-path: polygon(100% 0%, 100% 100%, 100% 100%, 50% 100%, 50% 100%, 50% 50%, 50% 0%);\r\n  }\r\n  37.5% {\r\n    -webkit-clip-path: polygon(100% 0%, 100% 100%, 100% 100%, 100% 100%, 100% 100%, 50% 50%, 50% 0%);\r\n  }\r\n  25% {\r\n    -webkit-clip-path: polygon(100% 0%, 100% 50%, 100% 50%, 100% 50%, 100% 50%, 50% 50%, 50% 0%);\r\n  }\r\n  12.5% {\r\n    -webkit-clip-path: polygon(100% 0%, 100% 0%, 100% 0%, 100% 0%, 100% 0%, 50% 50%, 50% 0%);\r\n  }\r\n  0% {\r\n    -webkit-clip-path: polygon(100% 0%, 100% 0%, 100% 0%, 100% 0%, 50% 0%, 50% 50%, 50% 0%);\r\n    -webkit-box-shadow: inset 0px 0px 0px 18px #999;\r\n  }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}