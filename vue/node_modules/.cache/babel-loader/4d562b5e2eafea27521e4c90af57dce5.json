{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport \"core-js/modules/es.string.match.js\";\nimport \"core-js/modules/web.atob.js\";\nimport \"core-js/modules/web.dom-exception.constructor.js\";\nimport \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/web.dom-exception.to-string-tag.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.typed-array.uint8-array.js\";\nimport \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.copy-within.js\";\nimport \"core-js/modules/es.typed-array.every.js\";\nimport \"core-js/modules/es.typed-array.fill.js\";\nimport \"core-js/modules/es.typed-array.filter.js\";\nimport \"core-js/modules/es.typed-array.find.js\";\nimport \"core-js/modules/es.typed-array.find-index.js\";\nimport \"core-js/modules/es.typed-array.for-each.js\";\nimport \"core-js/modules/es.typed-array.includes.js\";\nimport \"core-js/modules/es.typed-array.index-of.js\";\nimport \"core-js/modules/es.typed-array.iterator.js\";\nimport \"core-js/modules/es.typed-array.join.js\";\nimport \"core-js/modules/es.typed-array.last-index-of.js\";\nimport \"core-js/modules/es.typed-array.map.js\";\nimport \"core-js/modules/es.typed-array.reduce.js\";\nimport \"core-js/modules/es.typed-array.reduce-right.js\";\nimport \"core-js/modules/es.typed-array.reverse.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/es.typed-array.slice.js\";\nimport \"core-js/modules/es.typed-array.some.js\";\nimport \"core-js/modules/es.typed-array.sort.js\";\nimport \"core-js/modules/es.typed-array.subarray.js\";\nimport \"core-js/modules/es.typed-array.to-locale-string.js\";\nimport \"core-js/modules/es.typed-array.to-string.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.string.replace.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport axios from 'axios';\nexport default {\n  props: {},\n  data: function data() {\n    return {\n      ux: 2,\n      form: {},\n      user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {}\n    };\n  },\n  methods: {\n    getfile: function getfile(event) {\n      this.file = event.target.files[0];\n      var reader = new FileReader();\n      reader.readAsDataURL(this.file);\n\n      reader.onloadend = function () {\n        document.getElementById(\"img\").src = reader.result;\n      };\n    },\n    save: function save(event) {\n      var _this2 = this;\n\n      event.preventDefault();\n      var formData = new FormData();\n      formData.append('username', this.user.name);\n      formData.append('image', this.file);\n      console.log(this.file);\n      var url = 'https://xiaoku.store:5000/register';\n      axios.post(url, formData).then(function (res) {\n        alert(\"注册成功！\");\n        var url1 = 'http://localhost:9091/file/upload';\n        var file = new FormData();\n        file.append('file', _this2.file);\n        axios.post(url1, file).then(function (res) {\n          console.log(res);\n          _this2.form = {\n            id: _this2.user.id,\n            faceImage: res.data\n          };\n\n          _this2.request.post(\"/user\", _this2.form).then(function (res) {\n            if (res.code === '200') {\n              _this2.$message.success(\"保存成功\");\n            }\n          });\n        });\n      }).catch(function (err) {\n        alert(err);\n      });\n    },\n    openPhoto: function openPhoto() {\n      var _this3 = this;\n\n      navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: {\n          width: 720,\n          height: 720\n        }\n      }).then(function (success) {\n        // 摄像头开启成功\n        _this3.$refs[\"video\"].srcObject = success; //srcObject 是实时流\n        // 实时拍照效果\n\n        _this3.$refs[\"video\"].play();\n      }).catch(function (error) {\n        //摄像头开启失败\n        console.error(\"摄像头开启失败\");\n      });\n\n      var _this = this;\n\n      setTimeout(function () {\n        _this.photograph();\n      }, 2000);\n    },\n    base64toFile: function base64toFile(dataBase64) {\n      var filename = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'file';\n      var arr = dataBase64.split(',');\n      var mime = arr[0].match(/:(.*?);/)[1]; //设置file⽂件流的type名称\n\n      var suffix = mime.split('/')[1]; //设置file⽂件流的name名称\n\n      var bstr = window.atob(arr[1]);\n      var n = bstr.length;\n      var u8arr = new Uint8Array(n);\n\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n\n      return new File([u8arr], \"\".concat(filename, \".\").concat(suffix), {\n        type: mime\n      });\n    },\n    photograph: function photograph() {\n      var photoInfo = this.$refs[\"canvas\"].getContext(\"2d\"); // 把当前内容渲染到canvas上\n\n      photoInfo.drawImage(this.$refs[\"video\"], 20, 20); // //canvas图片 转base64格式、图片格式转换、图片质量压缩\n\n      var img = this.$refs[\"canvas\"].toDataURL(\"image/jpg\");\n      var imgBase64 = this.$refs[\"canvas\"].toDataURL(\"image/jpg\", 0.7);\n      var string = imgBase64.replace(\"data:image/jpg;base64,\", \"\");\n      string = this.base64toFile(imgBase64, 'camera');\n      console.log(string);\n      var formData = new FormData();\n      console.log(formData);\n      formData.append('image', string);\n      var url = 'https://xiaoku.store:5000/recognition';\n      axios.post(url, formData).then(function (res) {\n        console.log(res.data);\n      }).catch(function (err) {\n        alert(err);\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkEA;AACA;EACAA,SADA;EAIAC,IAJA,kBAIA;IACA;MACAC,KADA;MAEAC,QAFA;MAGAC;IAHA;EAKA,CAVA;EAYAC;IACAC,OADA,mBACAC,KADA,EACA;MACA;MACA;MACAC;;MACAA;QACAC;MACA,CAFA;IAGA,CARA;IASAC,IATA,gBASAH,KATA,EASA;MAAA;;MACAA;MACA;MACAI;MACAA;MACAC;MACA;MACAC,0BACAC,IADA,CACA;QACAC;QACA;QACA;QACAC;QACAH,uBACAC,IADA,CACA;UACAF;UACA;YACAK,kBADA;YAEAC;UAFA;;UAIA;YACA;cACA;YACA;UACA,CAJA;QAKA,CAZA;MAaA,CAnBA,EAoBAC,KApBA,CAoBA;QACAJ;MACA,CAtBA;IA0BA,CA1CA;IA2CAK,SA3CA,uBA2CA;MAAA;;MACAC,uBACAC,YADA,CACA;QACAC,WADA;QACAC;UAAAC;UAAAC;QAAA;MADA,CADA,EAIAZ,IAJA,CAIA;QACA;QACA,0CAFA,CAEA;QACA;;QACA;MACA,CATA,EAUAK,KAVA,CAUA;QACA;QACAP;MACA,CAbA;;MAcA;;MACAe;QACAC;MACA,CAFA,EAEA,IAFA;IAIA,CA/DA;IAgEAC,YAhEA,wBAgEAC,UAhEA,EAgEA;MAAA;MACA;MACA,sCAFA,CAEA;;MACA,gCAHA,CAGA;;MACA;MACA;MACA;;MACA;QACAC;MACA;;MACA;QACAC;MADA;IAGA,CA7EA;IA8EAC,UA9EA,wBA8EA;MACA,sDADA,CAEA;;MACAC,iDAHA,CAKA;;MACA;MACA;MACA;MACAC;MACAvB;MACA;MACAA;MACAD;MACA;MACAE,0BACAC,IADA,CACA;QACAF;MACA,CAHA,EAIAO,KAJA,CAIA;QACAJ;MACA,CANA;IAOA;EApGA;AAZA","names":["props","data","ux","form","user","methods","getfile","event","reader","document","save","formData","console","axios","then","alert","file","id","faceImage","catch","openPhoto","navigator","getUserMedia","audio","video","width","height","setTimeout","_this","base64toFile","dataBase64","u8arr","type","photograph","photoInfo","string"],"sourceRoot":"src/views","sources":["join.vue"],"sourcesContent":["<template>\n<div>\n  <div class=\"MyInfo\">\n    <div style=\"height: 60px\">\n      <h1>注册人脸识别图片</h1>\n    </div>\n  </div>\n  <el-divider></el-divider>\n  <el-card style=\"\n    width: 702px;\n    height: 602px;\" v-if=\"this.ux===1\"\n  >\n\n    <svg t=\"1659631163282\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"5466\" width=\"36\" height=\"36\"><path d=\"M231.36 218.16m78.86 0l448.4 0q78.86 0 78.86 78.86l0 448.4q0 78.86-78.86 78.86l-448.4 0q-78.86 0-78.86-78.86l0-448.4q0-78.86 78.86-78.86Z\" fill=\"#EFEFEF\" p-id=\"5467\"></path><path d=\"M725.68 476.52c0 130.92-86.14 287.86-192.42 287.86s-192.42-156.94-192.42-287.86 86.14-221.9 192.42-221.9 192.42 90.96 192.42 221.9z\" fill=\"#99D1FF\" p-id=\"5468\"></path><path d=\"M533.26 780.38c-55.16 0-108.28-36.34-149.62-102.34-36.82-58.78-58.8-134.12-58.8-201.52 0-135.62 89.6-237.88 208.42-237.88s208.42 102.26 208.42 237.88c0 67.4-22 142.74-58.8 201.52-41.32 65.96-94.46 102.34-149.62 102.34z m0-509.76c-47.6 0-91.68 20-124.12 56.48-33.74 37.88-52.3 90.94-52.3 149.4 0 61.64 20.16 130.62 54 184.54 34.76 55.5 79.4 87.32 122.5 87.32s87.74-31.84 122.5-87.32c33.76-54 54-122.9 54-184.54 0-58.46-18.58-111.52-52.3-149.4-32.6-36.42-76.68-56.48-124.28-56.48z\" fill=\"#18659E\" p-id=\"5469\"></path><path d=\"M534.54 548.62c-52.32 0-101.68-5.06-139-14.24-45.86-11.3-68.16-27.26-68.16-48.82s22.3-37.52 68.16-48.82c37.32-9.18 86.68-14.24 139-14.24s101.68 5.06 139 14.26c45.86 11.3 68.16 27.26 68.16 48.82s-22.3 37.52-68.16 48.82c-37.34 9.16-86.7 14.22-139 14.22z m-174.36-63.06c3.8 4 17.32 12.22 50.84 19.56 34 7.42 77.78 11.5 123.52 11.5s89.62-4 123.52-11.5c33.5-7.34 47.04-15.64 50.84-19.56-3.8-4-17.32-12.22-50.84-19.56-34-7.42-77.78-11.5-123.52-11.5s-89.62 4-123.52 11.5c-33.52 7.32-47.02 15.62-50.86 19.56z\" fill=\"#18659E\" p-id=\"5470\"></path><path d=\"M517.26 254.62h32v509.76h-32zM146.88 357.16a16 16 0 0 1-16-16v-222a16 16 0 0 1 16-16h245.82a16 16 0 0 1 0 32H162.88v206a16 16 0 0 1-16 16zM392.7 915.1H146.88a16 16 0 0 1-16-16V632a16 16 0 0 1 32 0v251.1h229.82a16 16 0 0 1 0 32zM926.88 915.1H683.44a16 16 0 0 1 0-32h227.44V632a16 16 0 0 1 32 0v267.1a16 16 0 0 1-16 16zM926.88 357.16a16 16 0 0 1-16-16v-206H683.44a16 16 0 1 1 0-32h243.44a16 16 0 0 1 16 16v222a16 16 0 0 1-16 16z\" fill=\"#18659E\" p-id=\"5471\"></path></svg>\n    <span style=\" padding-left: 14px; position: relative; top: -11px; font-size: 18px;\">上传人脸识别照片</span>\n    <el-divider></el-divider>\n    <div class=\"camera-box\" style=\"position: relative; top: -307px; left: -5% \">\n\n<!--        <el-form-item label=\"用户名姓名:\">-->\n<!--          <el-input v-model=\"form.user_name\"  style=\"width:20%\"></el-input>-->\n<!--        </el-form-item>-->\n    <div class=\"renlian\" >\n      <img style=\"pointer-events: none;width: 130%; height: 129%;position: absolute; left: -15%;top: -14%;\" id=\"img\" src=\"../imgs/timg.png\" >\n      <div class=\"box\">\n        <div class=\"line\"></div>\n        <div class=\"bottom\">\n\n        </div>\n      </div>\n          <input style=\"right: -40px; opacity: 0;width: 280px; height: 275px;    top: -36px;position: absolute;\"\n                 type=\"file\" id=\"fileup\"  @change=\"getfile($event)\" >\n            <el-button @click=\"ux=2\">取 消</el-button>\n            <el-button type=\"primary\" @click=\"save($event)\">确 定</el-button>\n  </div>\n\n\n </div>\n  </el-card>\n\n\n\n  <el-card style=\" width: 1200px; height: 690px;\" v-if=\"this.ux===2\">\n    <svg t=\"1659631982744\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"7781\" width=\"25\" height=\"25\"><path d=\"M370.323 184l-34.607 132.29L127 344.086V841h773V344.055l-210.831-28.207L654.677 184H370.323z m-82.459 78.132l24.412-93.317c6.907-26.4 30.758-44.815 58.047-44.815h284.354c27.289 0 51.14 18.415 58.047 44.815l24.303 92.901 170.93 22.87c29.796 3.986 52.043 29.407 52.043 59.47V841c0 33.137-26.863 60-60 60H127c-33.137 0-60-26.863-60-60V344.087c0-30.076 22.267-55.504 52.079-59.475l168.785-22.48z\" fill=\"#239fe0\" p-id=\"7782\"></path><path d=\"M512.5 781C387.96 781 287 680.04 287 555.5S387.96 330 512.5 330 738 430.96 738 555.5 637.04 781 512.5 781z m0-60c91.403 0 165.5-74.097 165.5-165.5S603.903 390 512.5 390 347 464.097 347 555.5 421.097 721 512.5 721z\" fill=\"#239fe0\" p-id=\"7783\"></path></svg>\n    <span style=\"       padding-left: 14px; position: relative; top: -5px; font-size: 18px;\">拍取人脸识别照片</span>\n    <el-divider></el-divider>\n\n    <div>\n      <!--开启摄像头-->\n      <el-button size=\"mini\"   @click=\"openPhoto\" >摄像头</el-button>\n      <!--canvas截取流-->\n      <div >\n      <canvas ref=\"canvas\" height=\"500\" width=\"500\" ></canvas>\n      </div>\n      <!--图片展示-->\n      <div class=\"renlian1\"style=\"position: relative;border:5px solid #909399;left: 633px; top: -511px; height: 500px; width: 500px;\">\n              <video  ref=\"video\" style=\" height: 100%;width:100%\" muted autoplay playsinline></video>\n      </div>\n      <!--确认-->\n      <!--  <el-button size=\"mini\"  @click=\"photograph\">拍照</el-button>-->\n\n    </div>\n\n  </el-card>\n</div>\n</template>\n<script>\nimport axios from 'axios'\nexport default {\n  props:{\n\n  },\n  data() {\n    return {\n      ux:2,\n      form:{},\n      user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {},\n    }\n  },\n\n  methods: {\n    getfile(event){\n    this.file=event.target.files[0];\n      var reader = new  FileReader();\n      reader.readAsDataURL(this.file);\n      reader.onloadend = function () {\n        document.getElementById(\"img\").src =  reader.result;\n      }\n    },\n    save(event){\n      event.preventDefault();\n      let formData=new FormData()\n      formData.append('username',this.user.name)\n      formData.append('image',this.file)\n      console.log(this.file)\n      let url = 'https://xiaoku.store:5000/register'\n      axios.post(url, formData)\n          .then(res => {\n            alert(\"注册成功！\")\n            let url1 = 'http://localhost:9091/file/upload'\n            let file=new FormData()\n            file.append('file',this.file)\n            axios.post(url1, file)\n                .then(res => {\n                  console.log(res)\n                  this.form={\n                    id:this.user.id,\n                    faceImage:res.data\n                  }\n                  this.request.post(\"/user\", this.form).then(res => {\n                    if (res.code === '200') {\n                      this.$message.success(\"保存成功\")\n                    }\n                  })\n                })\n          })\n          .catch(err => {\n            alert(err)\n          })\n\n\n\n    },\n    openPhoto() {\n      navigator.mediaDevices\n          .getUserMedia({\n            audio: true, video: { width: 720, height: 720 }\n          })\n          .then((success) => {\n            // 摄像头开启成功\n            this.$refs[\"video\"].srcObject = success; //srcObject 是实时流\n            // 实时拍照效果\n            this.$refs[\"video\"].play();\n          })\n          .catch((error) => {\n            //摄像头开启失败\n            console.error(\"摄像头开启失败\");\n          });\n      let _this=this\n      setTimeout(function()  {\n        _this.photograph()\n      }, 2000);\n\n    },\n    base64toFile (dataBase64, filename = 'file') {\n      let arr = dataBase64.split(',')\n      let mime = arr[0].match(/:(.*?);/)[1]  //设置file⽂件流的type名称\n      let suffix = mime.split('/')[1]  //设置file⽂件流的name名称\n      const bstr = window.atob(arr[1]);\n      let n = bstr.length\n      const u8arr = new Uint8Array(n)\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n)\n      }\n      return new File([u8arr], `${filename}.${suffix}`, {\n        type: mime\n      })\n    },\n    photograph() {\n      let photoInfo= this.$refs[\"canvas\"].getContext(\"2d\");\n      // 把当前内容渲染到canvas上\n      photoInfo.drawImage(this.$refs[\"video\"], 20, 20);\n\n      // //canvas图片 转base64格式、图片格式转换、图片质量压缩\n      let img = this.$refs[\"canvas\"].toDataURL(\"image/jpg\");\n      let imgBase64 = this.$refs[\"canvas\"].toDataURL(\"image/jpg\", 0.7);\n      let string = imgBase64.replace(\"data:image/jpg;base64,\", \"\");\n      string=this.base64toFile(imgBase64, 'camera');\n      console.log(string)\n      let formData=new FormData()\n      console.log(formData)\n      formData.append('image',string)\n      var url = 'https://xiaoku.store:5000/recognition'\n      axios.post(url, formData)\n          .then(res => {\n            console.log(res.data)\n          })\n          .catch(err => {\n            alert(err)\n          })\n    }\n  }\n\n}\n\n</script>\n<style scoped>\n.renlian  {\n  position: relative;\n  height: 200px; width: 200px;\n  margin: 400px auto;\n   /*background-image: url(\"../imgs/timg.png\");*/\n  background-size: 100% 100%;\n}\n\n.renlian .box {\n  width: 30vw;\n  height: 30vw;\n  max-height: 30vh;\n  max-width: 30vh;\n  position: relative;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  overflow: hidden;\n  border: 0.1rem solid rgba(3, 169, 244, 0.2);\n}\n\n.renlian .line {\n  height: calc(100% - 2px);\n  width: 100%;\n  background: linear-gradient(180deg, rgba(0, 255, 51, 0) 43%, #03a9f4 211%);\n  border-bottom: 2px solid #03a9f4;\n  transform: translateY(-100%);\n  animation: radar-beam 2s infinite;\n  animation-timing-function: cubic-bezier(0.3, 0, 0.43, 0.7);\n  animation-delay: 1.4s;\n}\n\n.renlian .box:after,\n.renlian .box:before,\n.renlian .bottom:after,\n.renlian .bottom:before {\n  content: '';\n  display: block;\n  position: absolute;\n  width: 3vw;\n  height: 3vw;\n\n  border: 0.2rem solid transparent;\n}\n\n.renlian .box:after,\n.renlian .box:before {\n  top: 0;\n  border-top-color: #03a9f4;\n}\n\n.renlian .bottom:after,\n.renlian .bottom:before {\n  bottom: 0;\n  border-bottom-color: #03a9f4;\n}\n\n.renlian .box:before,\n.renlian .bottom:before {\n  left: 0;\n  border-left-color: #03a9f4;\n}\n\n.renlian .box:after,\n.renlian .bottom:after {\n  right: 0;\n  border-right-color: #03a9f4;\n}\n\n@keyframes radar-beam {\n  0% {\n    transform: translateY(-100%);\n  }\n\n  100% {\n    transform: translateY(0);\n  }\n}\nvideo {\n  width: 100%\n}\n\n</style>"]},"metadata":{},"sourceType":"module"}