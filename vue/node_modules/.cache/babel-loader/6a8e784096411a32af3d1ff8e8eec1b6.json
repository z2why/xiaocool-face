{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport axios from 'axios';\nexport default {\n  props: {},\n\n  created() {\n    this.openPhoto();\n  },\n\n  data() {\n    return {\n      ux: 1,\n      form: {},\n      user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {}\n    };\n  },\n\n  methods: {\n    getfile(event) {\n      this.file = event.target.files[0];\n      var reader = new FileReader();\n      reader.readAsDataURL(this.file);\n\n      reader.onloadend = function () {\n        document.getElementById(\"img\").src = reader.result;\n      };\n    },\n\n    save(event) {\n      event.preventDefault();\n      let formData = new FormData();\n      formData.append('username', this.user.name);\n      formData.append('image', this.file);\n      console.log(this.file);\n      let url = 'https://xiaoku.store:5000/register';\n      axios.post(url, formData).then(res => {\n        alert(\"注册成功！\");\n        let url1 = $baseUrl + '/service/cos/upload';\n        let file = new FormData();\n        file.append('file', this.file);\n        axios.post(url1, file).then(res => {\n          console.log(res);\n          this.form = {\n            id: this.user.id,\n            faceImage: res.data\n          };\n          this.request.post(\"/service/user\", this.form).then(res => {\n            if (res.code === '200') {\n              this.$message.success(\"保存成功\");\n            }\n          });\n        });\n      }).catch(err => {\n        alert(err);\n      });\n    },\n\n    openPhoto() {\n      navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: {\n          width: 720,\n          height: 720\n        }\n      }).then(success => {\n        // 摄像头开启成功\n        this.$refs[\"video\"].srcObject = success; //srcObject 是实时流\n        // 实时拍照效果\n\n        this.$refs[\"video\"].play();\n      }).catch(error => {\n        //摄像头开启失败\n        console.error(\"摄像头开启失败\");\n      }); // let _this=this\n      // setTimeout(function()  {\n      //   _this.photograph()\n      // }, 2000);\n    },\n\n    base64toFile(dataBase64, filename = 'file') {\n      let arr = dataBase64.split(',');\n      let mime = arr[0].match(/:(.*?);/)[1]; //设置file⽂件流的type名称\n\n      let suffix = mime.split('/')[1]; //设置file⽂件流的name名称\n\n      const bstr = window.atob(arr[1]);\n      let n = bstr.length;\n      const u8arr = new Uint8Array(n);\n\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n\n      return new File([u8arr], `${filename}.${suffix}`, {\n        type: mime\n      });\n    },\n\n    photograph() {\n      let photoInfo = this.$refs[\"canvas\"].getContext(\"2d\"); // 把当前内容渲染到canvas上\n\n      photoInfo.drawImage(this.$refs[\"video\"], 0, 0, 480, 480); // //canvas图片 转base64格式、图片格式转换、图片质量压缩\n\n      let img = this.$refs[\"canvas\"].toDataURL(\"image/jpg\");\n      let imgBase64 = this.$refs[\"canvas\"].toDataURL(\"image/jpg\", 0.7);\n      let string = imgBase64.replace(\"data:image/jpg;base64,\", \"\");\n      string = this.base64toFile(imgBase64, 'camera');\n      console.log(string);\n      let formData = new FormData();\n      console.log(formData);\n      formData.append('image', string);\n      var url = 'https://xiaoku.store:5000/recognition';\n      axios.post(url, formData).then(res => {\n        console.log(res.data);\n      }).catch(err => {\n        alert(err);\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2EA;AAEA;EACAA,SADA;;EAIAC;IACA;EACA,CANA;;EAQAC;IACA;MACAC,KADA;MAEAC,QAFA;MAGAC;IAHA;EAKA,CAdA;;EAgBAC;IACAC;MACA;MACA;MACAC;;MACAA;QACAC;MACA,CAFA;IAGA,CARA;;IASAC;MACAC;MACA;MACAC;MACAA;MACAC;MACA;MACAC,0BACAC,IADA,CACAC;QACAC;QACA;QACA;QACAC;QACAJ,uBACAC,IADA,CACAC;UACAH;UACA;YACAM,gBADA;YAEAC;UAFA;UAIA;YACA;cACA;YACA;UACA,CAJA;QAKA,CAZA;MAaA,CAnBA,EAoBAC,KApBA,CAoBAC;QACAL;MACA,CAtBA;IA0BA,CA1CA;;IA2CAM;MACAC,uBACAC,YADA,CACA;QACAC,WADA;QACAC;UAAAC;UAAAC;QAAA;MADA,CADA,EAIAd,IAJA,CAIAe;QACA;QACA,wCAFA,CAEA;QACA;;QACA;MACA,CATA,EAUAT,KAVA,CAUAU;QACA;QACAlB;MACA,CAbA,EADA,CAeA;MACA;MACA;MACA;IAEA,CA/DA;;IAgEAmB;MACA;MACA,sCAFA,CAEA;;MACA,gCAHA,CAGA;;MACA;MACA;MACA;;MACA;QACAC;MACA;;MACA;QACAC;MADA;IAGA,CA7EA;;IA8EAC;MACA,sDADA,CAEA;;MACAC,yDAHA,CAKA;;MACA;MACA;MACA;MACAC;MACAxB;MACA;MACAA;MACAD;MACA;MACAE,0BACAC,IADA,CACAC;QACAH;MACA,CAHA,EAIAQ,KAJA,CAIAC;QACAL;MACA,CANA;IAOA;;EApGA;AAhBA","names":["props","created","data","ux","form","user","methods","getfile","reader","document","save","event","formData","console","axios","then","res","alert","file","id","faceImage","catch","err","openPhoto","navigator","getUserMedia","audio","video","width","height","success","error","base64toFile","u8arr","type","photograph","photoInfo","string"],"sourceRoot":"src/views","sources":["join.vue"],"sourcesContent":["<template>\n<div>\n  <div class=\"MyInfo\">\n    <div style=\"数据统计: 60px\">\n      <h1>注册人脸识别图片</h1>\n    </div>\n  </div>\n  <el-divider></el-divider>\n  <el-card style=\"\n    width: 702px;\n    height: 602px;\" v-if=\"this.ux===1\">\n\n    <svg t=\"1659631163282\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"5466\" width=\"36\" height=\"36\"><path d=\"M231.36 218.16m78.86 0l448.4 0q78.86 0 78.86 78.86l0 448.4q0 78.86-78.86 78.86l-448.4 0q-78.86 0-78.86-78.86l0-448.4q0-78.86 78.86-78.86Z\" fill=\"#EFEFEF\" p-id=\"5467\"></path><path d=\"M725.68 476.52c0 130.92-86.14 287.86-192.42 287.86s-192.42-156.94-192.42-287.86 86.14-221.9 192.42-221.9 192.42 90.96 192.42 221.9z\" fill=\"#99D1FF\" p-id=\"5468\"></path><path d=\"M533.26 780.38c-55.16 0-108.28-36.34-149.62-102.34-36.82-58.78-58.8-134.12-58.8-201.52 0-135.62 89.6-237.88 208.42-237.88s208.42 102.26 208.42 237.88c0 67.4-22 142.74-58.8 201.52-41.32 65.96-94.46 102.34-149.62 102.34z m0-509.76c-47.6 0-91.68 20-124.12 56.48-33.74 37.88-52.3 90.94-52.3 149.4 0 61.64 20.16 130.62 54 184.54 34.76 55.5 79.4 87.32 122.5 87.32s87.74-31.84 122.5-87.32c33.76-54 54-122.9 54-184.54 0-58.46-18.58-111.52-52.3-149.4-32.6-36.42-76.68-56.48-124.28-56.48z\" fill=\"#18659E\" p-id=\"5469\"></path><path d=\"M534.54 548.62c-52.32 0-101.68-5.06-139-14.24-45.86-11.3-68.16-27.26-68.16-48.82s22.3-37.52 68.16-48.82c37.32-9.18 86.68-14.24 139-14.24s101.68 5.06 139 14.26c45.86 11.3 68.16 27.26 68.16 48.82s-22.3 37.52-68.16 48.82c-37.34 9.16-86.7 14.22-139 14.22z m-174.36-63.06c3.8 4 17.32 12.22 50.84 19.56 34 7.42 77.78 11.5 123.52 11.5s89.62-4 123.52-11.5c33.5-7.34 47.04-15.64 50.84-19.56-3.8-4-17.32-12.22-50.84-19.56-34-7.42-77.78-11.5-123.52-11.5s-89.62 4-123.52 11.5c-33.52 7.32-47.02 15.62-50.86 19.56z\" fill=\"#18659E\" p-id=\"5470\"></path><path d=\"M517.26 254.62h32v509.76h-32zM146.88 357.16a16 16 0 0 1-16-16v-222a16 16 0 0 1 16-16h245.82a16 16 0 0 1 0 32H162.88v206a16 16 0 0 1-16 16zM392.7 915.1H146.88a16 16 0 0 1-16-16V632a16 16 0 0 1 32 0v251.1h229.82a16 16 0 0 1 0 32zM926.88 915.1H683.44a16 16 0 0 1 0-32h227.44V632a16 16 0 0 1 32 0v267.1a16 16 0 0 1-16 16zM926.88 357.16a16 16 0 0 1-16-16v-206H683.44a16 16 0 1 1 0-32h243.44a16 16 0 0 1 16 16v222a16 16 0 0 1-16 16z\" fill=\"#18659E\" p-id=\"5471\"></path></svg>\n    <span style=\" padding-left: 14px; position: relative; top: -11px; font-size: 18px;\">上传人脸识别照片</span>\n    <el-divider></el-divider>\n    <div class=\"camera-box\" style=\"position: relative; top: -307px; left: -5% \">\n\n<!--        <el-form-item label=\"用户名姓名:\">-->\n<!--          <el-input v-model=\"form.user_name\"  style=\"width:20%\"></el-input>-->\n<!--        </el-form-item>-->\n    <div class=\"renlian\" >\n\n      <img style=\"pointer-events: none;width: 130%; height: 129%;position: absolute; left: -15%;top: -14%;\" id=\"img\" src=\"../imgs/timg.png\" >\n      <div class=\"box\">\n        <div class=\"line\"></div>\n        <div class=\"bottom\">\n\n        </div>\n      </div>\n          <input style=\"right: -40px; opacity: 0;width: 280px; height: 275px;    top: -36px;position: absolute;\"\n                 type=\"file\" id=\"fileup\"  @change=\"getfile($event)\" >\n            <el-button type=\"primary\" plain @click=\"save($event)\" style=\"left: 60px;position: relative;    top: 38px;\" >上 传</el-button>\n\n  </div>\n\n\n </div>\n  </el-card>\n\n\n\n<!--  <el-card style=\"width: 1257px;-->\n<!--    height: 793px\" v-if=\"this.ux===2\">-->\n<!--    <svg t=\"1659631982744\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"7781\" width=\"25\" height=\"25\"><path d=\"M370.323 184l-34.607 132.29L127 344.086V841h773V344.055l-210.831-28.207L654.677 184H370.323z m-82.459 78.132l24.412-93.317c6.907-26.4 30.758-44.815 58.047-44.815h284.354c27.289 0 51.14 18.415 58.047 44.815l24.303 92.901 170.93 22.87c29.796 3.986 52.043 29.407 52.043 59.47V841c0 33.137-26.863 60-60 60H127c-33.137 0-60-26.863-60-60V344.087c0-30.076 22.267-55.504 52.079-59.475l168.785-22.48z\" fill=\"#239fe0\" p-id=\"7782\"></path><path d=\"M512.5 781C387.96 781 287 680.04 287 555.5S387.96 330 512.5 330 738 430.96 738 555.5 637.04 781 512.5 781z m0-60c91.403 0 165.5-74.097 165.5-165.5S603.903 390 512.5 390 347 464.097 347 555.5 421.097 721 512.5 721z\" fill=\"#239fe0\" p-id=\"7783\"></path></svg>-->\n<!--    <span style=\"       padding-left: 14px; position: relative; top: -5px; font-size: 18px;\">拍取人脸识别照片</span>-->\n<!--    <el-divider></el-divider>-->\n\n<!--    <div>-->\n<!--      &lt;!&ndash;开启摄像头&ndash;&gt;-->\n<!--&lt;!&ndash;      <el-button size=\"mini\" @click=\"openPhoto\">摄像头</el-button>&ndash;&gt;-->\n<!--      &lt;!&ndash;canvas截取流&ndash;&gt;  &lt;!&ndash;图片展示&ndash;&gt;-->\n<!--      <div class=\"rain\">-->\n\n<!--        <div class=\"rainbow\" style=\"  padding: 5px 5px 5px 5px;  left: auto;width: 500px; height: 500px;\">-->\n<!--          <video  ref=\"video\" style=\" height: 100%;width:100%\" muted autoplay playsinline></video>-->\n<!--        </div>-->\n<!--        <svg  @click=\"photograph\" style=\"position: relative; left: 217px; top: 70px;}\" t=\"1659901146637\" class=\"icon\" viewBox=\"0 0 1032 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"1641\" width=\"64\" height=\"64\"><path d=\"M512 1024C229.236953 1024 0 794.784665 0 512 0 229.236953 229.236953 0 512 0c282.763047 0 512 229.236953 512 512 0 282.763047-229.215335 512-512 512z m0-68.247931c245.082925 0 443.752069-198.669144 443.752069-443.752069 0-245.061307-198.669144-443.730451-443.752069-443.730451-245.061307 0-443.730451 198.669144-443.730451 443.730451 0 245.082925 198.669144 443.752069 443.730451 443.752069z m0-47.797332C293.355852 907.954737 116.045263 730.687384 116.045263 512c0-218.665766 177.267353-395.954737 395.954737-395.954737S907.954737 293.312616 907.954737 512 730.687384 907.954737 512 907.954737z\" p-id=\"1642\" fill=\"#ffffff\"></path></svg>-->\n<!--      </div>-->\n<!--      <el-button @click=\"ux=1\">已有照片,进行上传</el-button>-->\n<!--      &lt;!&ndash;      视频流&ndash;&gt;-->\n<!--      <div class=\"renlian1\"  style=\"position:relative;border:5px solid #909399;left: 633px; top: -511px; height: 500px; width: 500px;\">-->\n<!--        <canvas ref=\"canvas\" height=\"500\" width=\"500\"-->\n<!--                style=\"position: absolute;left: -21px; transform: rotateY(180deg); PADDING: 0px 0px 0px 12px; width: 511px;height: 511px;\"></canvas>-->\n\n<!--        &lt;!&ndash;      确认&ndash;&gt;-->\n<!--&lt;!&ndash;        <el-button size=\"mini\" style=\"position: relative;top: 1px\" @click=\"photograph\">拍照</el-button>&ndash;&gt;-->\n<!--      </div>-->\n\n\n<!--    </div>-->\n\n<!--  </el-card>-->\n</div>\n</template>\n<script>\nimport axios from 'axios'\n\nexport default {\n  props:{\n\n  },\n  created(){\n   this.openPhoto();\n  }\n,\n  data() {\n    return {\n      ux:1,\n      form:{},\n      user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {},\n    }\n  },\n\n  methods: {\n    getfile(event){\n    this.file=event.target.files[0];\n      var reader = new  FileReader();\n      reader.readAsDataURL(this.file);\n      reader.onloadend = function () {\n        document.getElementById(\"img\").src =  reader.result;\n      }\n    },\n    save(event){\n      event.preventDefault();\n      let formData=new FormData()\n      formData.append('username',this.user.name)\n      formData.append('image',this.file)\n      console.log(this.file)\n      let url = 'https://xiaoku.store:5000/register'\n      axios.post(url, formData)\n          .then(res => {\n            alert(\"注册成功！\")\n            let url1 = $baseUrl+'/service/cos/upload'\n            let file=new FormData()\n            file.append('file',this.file)\n            axios.post(url1, file)\n                .then(res => {\n                  console.log(res)\n                  this.form={\n                    id:this.user.id,\n                    faceImage:res.data\n                  }\n                  this.request.post(\"/service/user\", this.form).then(res => {\n                    if (res.code === '200') {\n                      this.$message.success(\"保存成功\")\n                    }\n                  })\n                })\n          })\n          .catch(err => {\n            alert(err)\n          })\n\n\n\n    },\n    openPhoto() {\n      navigator.mediaDevices\n          .getUserMedia({\n            audio: true, video: { width: 720, height: 720 }\n          })\n          .then((success) => {\n            // 摄像头开启成功\n            this.$refs[\"video\"].srcObject = success; //srcObject 是实时流\n            // 实时拍照效果\n            this.$refs[\"video\"].play();\n          })\n          .catch((error) => {\n            //摄像头开启失败\n            console.error(\"摄像头开启失败\");\n          });\n      // let _this=this\n      // setTimeout(function()  {\n      //   _this.photograph()\n      // }, 2000);\n\n    },\n    base64toFile (dataBase64, filename = 'file') {\n      let arr = dataBase64.split(',')\n      let mime = arr[0].match(/:(.*?);/)[1]  //设置file⽂件流的type名称\n      let suffix = mime.split('/')[1]  //设置file⽂件流的name名称\n      const bstr = window.atob(arr[1]);\n      let n = bstr.length\n      const u8arr = new Uint8Array(n)\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n)\n      }\n      return new File([u8arr], `${filename}.${suffix}`, {\n        type: mime\n      })\n    },\n    photograph() {\n      let photoInfo= this.$refs[\"canvas\"].getContext(\"2d\");\n      // 把当前内容渲染到canvas上\n      photoInfo.drawImage(this.$refs[\"video\"], 0, 0,480,480);\n\n      // //canvas图片 转base64格式、图片格式转换、图片质量压缩\n      let img = this.$refs[\"canvas\"].toDataURL(\"image/jpg\");\n      let imgBase64 = this.$refs[\"canvas\"].toDataURL(\"image/jpg\", 0.7);\n      let string = imgBase64.replace(\"data:image/jpg;base64,\", \"\");\n      string=this.base64toFile(imgBase64, 'camera');\n      console.log(string)\n      let formData=new FormData()\n      console.log(formData)\n      formData.append('image',string)\n      var url = 'https://xiaoku.store:5000/recognition'\n      axios.post(url, formData)\n          .then(res => {\n            console.log(res.data)\n          })\n          .catch(err => {\n            alert(err)\n          })\n    }\n  }\n\n}\n\n</script>\n<style scoped>\n.renlian  {\n  position: relative;\n  height: 200px; width: 200px;\n  margin: 400px auto;\n\n  background-size: 100% 100%;\n}\n\n.renlian .box {\n  width: 30vw;\n  height: 30vw;\n  max-height: 30vh;\n  max-width: 30vh;\n  position: relative;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  overflow: hidden;\n  border: 0.1rem solid rgba(3, 169, 244, 0.2);\n}\n\n.renlian .line {\n  height: calc(100% - 2px);\n  width: 100%;\n  background: linear-gradient(180deg, rgba(0, 255, 51, 0) 43%, #03a9f4 211%);\n  border-bottom: 2px solid #03a9f4;\n  transform: translateY(-100%);\n  animation: radar-beam 2s infinite;\n  animation-timing-function: cubic-bezier(0.3, 0, 0.43, 0.7);\n  animation-delay: 1.4s;\n}\n\n.renlian .box:after,\n.renlian .box:before,\n.renlian .bottom:after,\n.renlian .bottom:before {\n  content: '';\n  display: block;\n  position: absolute;\n  width: 3vw;\n  height: 3vw;\n\n  border: 0.2rem solid transparent;\n}\n\n.renlian .box:after,\n.renlian .box:before {\n  top: 0;\n  border-top-color: #03a9f4;\n}\n\n.renlian .bottom:after,\n.renlian .bottom:before {\n  bottom: 0;\n  border-bottom-color: #03a9f4;\n}\n\n.renlian .box:before,\n.renlian .bottom:before {\n  left: 0;\n  border-left-color: #03a9f4;\n}\n\n.renlian .box:after,\n.renlian .bottom:after {\n  right: 0;\n  border-right-color: #03a9f4;\n}\n\n\nvideo {\n  width: 100%;\n  transform: rotateY(180deg);\n  -moz-transform: rotateY(180deg);\n}\n\n.rain>img{\n  HEIGHT: 662PX;\n  WIDTH: 499PX;\n  POSITION: absolute;\n  TOP: 295PX;\n\n}\n</style>"]},"metadata":{},"sourceType":"module"}